<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml">
    <ui:define name="title">#{irsReportUpload.pageTitle}</ui:define>
    <ui:define name="content">
	<h:form id="form" prependId="false">
	    <p:panel header="上傳資料">
		<h:panelGrid id="confirmation" columns="3" columnClasses="grid,grid,grid">
		    <h:panelGrid columns="2" columnClasses="label, value">
			<h:outputLabel value="#{msgApp['app.label.report.ym']}: "/>
			<h:outputText value="#{irsReportUpload.yearMonth}" styleClass="rptYearMonth"/>
			<h:outputLabel  value="個體公司:" escape="false" />
			<h:outputText value="#{irsReportUpload.company.toString()}" styleClass="outputLabel"/>
		    </h:panelGrid>
		</h:panelGrid>
		<h:panelGrid columns="3">
		    <h:outputLabel value="報表檔案:"/>
		    <h:panelGroup>
			<ui:include src="/include/inc_attachment.xhtml">
			    <ui:param name="uploadUpdate" value=":form:btnSave :form:tabview"/>
			    <ui:param name="process" value=""/>
			</ui:include>
		    </h:panelGroup>
		    <p:messages id="pmsg" autoUpdate="true"/>
		</h:panelGrid>
		<hr/>
		<p:commandButton id="btnSave"
				 value="#{msgApp['app.button.save']}"
				 icon="ui-icon-disk"
				 disabled="#{not irsReportUpload.allowSave()}"
				 action="#{irsReportUpload.save}"
				 onstart="return saveVerify()"
				 />
                <p:spacer width="5"/>
		<p:button value="#{msgApp['app.button.cancel']}"
			  icon="ui-icon-cancel"
			  outcome="importSheetData.xhtml"/>
<!--		<p:spacer width="2"/>
		<h:link outcome="/attachment/queryAttachment.xhtml?faces-redirect=true" 
			includeViewParams="true"
			target="viewLaw">已上傳檔案歷史查詢
		    <f:param name="pageCode" value="#{importSheetDataTabsController.pageCode}" />
		    <h:graphicImage title="已上傳檔案歷史查詢"
				    library="images" 
				    name="page_view.png"/>
		</h:link>-->
		<p:tabView id="tabview">
		    <p:tab title="關系人對帳交易記錄">
			<ui:include src="inc_importExcel_ztcoRelaDtl.xhtml">
			    <ui:param name="importController" value="#{irsReportUpload.importZtcoRelaDtlController}"/>
			</ui:include>
		    </p:tab>
		    <p:tab title="關係人帳進銷項發票記錄">
			<ui:include src="inc_importExcel_ztcoRelaGui.xhtml">
			    <ui:param name="importController" value="#{irsReportUpload.importZtcoRelaGuiController}"/>
			</ui:include>
		    </p:tab>
		</p:tabView>
	    </p:panel>
	</h:form>

        <script type="text/javascript">
            //<![CDATA[
            function saveVerify() {
                var files = jQuery('#uploadFilesGroup a.uploadFile');
                if (files.length === 0) {
                    alert('#{msgApp['app.error.upload']}');
                    return false;
                }
                return confirm('#{msgApp['app.confirm.save']}');
            }
            //]]>
        </script>
    </ui:define>
</ui:composition>
<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/template.xhtml"
                >
    <ui:define name="title">
        <h:outputText value="#{msg['header.app_name']}" />
    </ui:define>
    <ui:define name="head">
        <style type="text/css">
        </style>
        <script type="text/javascript">
            //<![CDATA[
            $(function () {
                // for datatable resize in chrome 
                doResize();
                $(window).resize(function () {
                    doResize();
                });
            });
            
            function afterQuery(){
                doResize();
                scrollY(200);
            }
            
            function confirmDel(){
                // 確定要變更此商品上、下架狀態嗎?
                return confirm("確定要變更此商品上、下架狀態嗎?");
            }
            //]]>
        </script>
    </ui:define>
    <ui:define name="header"><h:outputText value="#{impTccPrd.funcTitle}" /></ui:define>
    <ui:define name="content">
        <!-- 移動查詢結果 -->
        <ui:include src="/inc/inc_moveDatatbale.xhtml"></ui:include>
        <!-- 公用訊息區 -->
        <ui:include src="/inc/inc_globalMessage.xhtml"></ui:include>
        
        <h:form id="fmMain" prependId="false" rendered="#{!impTccPrd.functionDenied}" >
            <!-- BEGIN: 查詢結果區 -->
            <div class="topOfResult" ></div>
            <p:panel id="plResult" header="#{msg['search.result']}" >
                <h:panelGroup id="listGroup">
                    <!-- 共 ? 筆 -->
                    <h:outputText id="otRowCount" class="rowCount" 
                                  value="(#{msg['total.result']}#{impTccPrd.lazyModel.rowCount}#{msg['search.item']})" 
                                  rendered="#{not empty impTccPrd.lazyModel}" />
                    
                    <p:remoteCommand name="getRowCountAfterFiltered" update=":fmMain:otRowCount" />
                    
                    <p:dataTable id="dtResult" var="row" lazy="true" reflow="true"
                                 widgetVar="wvDTResult"
                                 value="#{impTccPrd.lazyModel}" 
                                 filteredValue="#{impTccPrd.filterResultList}"
                                 styleClass="ui-datatable-hor-scroll"
                                 paginator="true"
                                 scrollable="true" 
                                 paginatorPosition="bottom"
                                 rows="20"
                                 rowsPerPageTemplate="5,10,20,30,40,50"
                                 >
                        <p:ajax event="filter" oncomplete="getRowCountAfterFiltered();" />
                        <p:ajax event="page" process="@none" immediate="true" />
                        <p:ajax event="sort" process="@none" immediate="true" />
                        <!-- 上、下架 -->
                        <p:column headerText="上、下架" styleClass="tac" width="50" >
                            <p:selectBooleanCheckbox value="#{row.existed}" >
                                <p:ajax event="change" listener="#{impTccPrd.doUpDown(row)}" 
                                        oncomplete="afterCallBackHandler(xhr, status, args, true);" />
                            </p:selectBooleanCheckbox>
                        </p:column>
                        <!-- 商品代碼 -->
                        <p:column headerText="商品代碼" width="120" >
                            <h:outputText value="#{row.code}" />
                        </p:column>
                        <!-- 商品名稱 -->
                        <p:column headerText="商品名稱" width="150" >
                            <h:outputText value="#{row.name}" />
                        </p:column>
                    </p:dataTable>
                </h:panelGroup>
            </p:panel>
        </h:form>
        
        <!-- 功能權限檢查對話框 -->
        <ui:include src="/inc/inc_authorizationDlg.xhtml">
            <ui:param name="controller" value="#{impTccPrd}"/>
        </ui:include>
    </ui:define>
</ui:composition>

<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/template.xhtml"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <ui:define name="title">
        <h:outputText value="#{msg['header.app_name']}" />
    </ui:define>
    <ui:define name="head">
        <style  type="text/css">
        </style>
        <script type="text/javascript">
            //<![CDATA[
            function afterPlantReindex(xhr, status, args){
                afterCallBackHandler(xhr, status, args);
                alert("因保種紀錄資料筆數可能較多，採用非同步方式執行。\n請一段時間過後，再由全文檢索查詢功能查看執行結果。");
            }
            //]]>
        </script>
    </ui:define>
    <ui:define name="header">
        <h:outputText value="#{su.funcTitle}" />
    </ui:define>
    <ui:define name="content">
        <!-- 公用訊息區 -->
        <ui:include src="/inc/inc_globalMessage.xhtml"></ui:include>
        
        <h:form id="fmMain" prependId="false" rendered="#{!su.functionDenied}" >
            <p:fieldset legend="系統管理功能" rendered="true" collapsed="true" toggleable="true" >
                <h:outputText value="驗證人員權限設定：" />
                <p:autoComplete size="25" value="#{su.selectedUserTxt}"
                                completeMethod="#{su.autoCompleteUserOptions}" 
                                onkeypress="ajaxStatusShow=false" onblur="ajaxStatusShow=true" 
                                dropdown="true"
                                >
                </p:autoComplete>
                <p:spacer width="5" height="2"/>
                <p:commandButton value="確定" action="#{su.selectUser}"/>
                <p:spacer width="5"/>
                <h:outputText value="(請於下拉選單點選人員)" />
                <br/>
                <h:outputText value="(注意：驗證過程，系統會封鎖所有資料異動。)" styleClass="info" />
            </p:fieldset>
            
            <p:separator />
            
            <p:fieldset legend="線上使用者" toggleable="true" >
                <p:commandLink update=":fmMain:dtOnlineUsers"
                               title="重載線上使用者資訊" 
                               oncomplete="alert('已重載完成。');" >
                    <h:graphicImage library="images" name="update.png" styleClass="icons" />重載線上使用者資訊
                </p:commandLink>
                <p:dataTable id="dtOnlineUsers" value="#{app.onlineUsers}" var="row" rowIndexVar="idx" >
                    <p:column>
                        <f:facet name="header"><h:outputText value="序號" /></f:facet>
                        <h:outputText value="#{idx+1}" />
                    </p:column>
                    <p:column sortBy="#{row.loginAccount}" >
                        <f:facet name="header"><h:outputText value="帳號" /></f:facet>
                        <h:outputText value="#{row.loginAccount}" />
                    </p:column>
                    <p:column sortBy="#{row.cname}" >
                        <f:facet name="header"><h:outputText value="姓名" /></f:facet>
                        <h:outputText value="#{row.cname}" />
                    </p:column>
                    <p:column sortBy="#{row.email}" >
                        <f:facet name="header"><h:outputText value="Email" /></f:facet>
                        <h:outputText value="#{row.email}" />
                    </p:column>
                </p:dataTable>
            </p:fieldset>
            
            <p:separator />

            <p:fieldset legend="全文檢索管理操作" toggleable="true" rendered="true" >
                <h:panelGroup rendered="true" >
                    <h:graphicImage library="images" name="add_milestone.png" styleClass="iconsBig" />
                    <p:outputLabel value="針對" />
                    <p:selectOneMenu value="#{search.docType}" >
                        <f:selectItem itemLabel="所有文章類別" noSelectionOption="true" />
                        <f:selectItems value="#{search.docTypeList}" var="item"
                                       itemLabel="#{item.displayName}" itemValue="#{item.code}" />
                    </p:selectOneMenu>
                    <p:selectOneMenu value="#{search.dataType}" >
                        <f:selectItem itemLabel="所有資料類型" noSelectionOption="true" />
                        <f:selectItems value="#{search.dataTypeList}" var="item"
                                       itemLabel="#{item.displayName}" itemValue="#{item.code}" />
                    </p:selectOneMenu>
                    <p:spacer width="3" height="5" />
                    <p:commandButton actionListener="#{search.reIndexforDoc()}"
                                   onstart="return confirm('確定要重建文章索引嗎?');" 
                                   value="重建索引"
                                   icon="ui-icon-document" 
                                   oncomplete="afterCallBackHandler(xhr, status, args);" />
                    <p:spacer width="3" height="5" />
                    <p:commandButton actionListener="#{search.clearAllIndex()}"
                                   onstart="return confirm('確定要刪除索引嗎?');" 
                                   value="刪除索引"
                                   icon="ui-icon-trash" 
                                   oncomplete="afterCallBackHandler(xhr, status, args);" />
                </h:panelGroup>
                
                <h:panelGroup rendered="false" >
                    <br/>
                    <h:graphicImage library="images" name="add_milestone.png" styleClass="iconsBig" />
                    <h:outputText value="Accession No.: 起" />
                    <p:inputText value="#{search.accessionNoS}" size="8" />
                    <h:outputText value="~ 迄" />
                    <p:inputText value="#{search.accessionNoE}" size="8" />

                    <p:spacer width="2" height="5" />

                    <p:commandButton actionListener="#{search.reIndexforPlant()}"
                                   onstart="return confirm('確定要重建保種紀錄索引嗎?');" 
                                   value="重建保種紀錄索引"
                                   icon="fa fa-pagelines" 
                                   oncomplete="afterPlantReindex(xhr, status, args);"
                                   title="已停用(因前端網頁不呈現保種紀錄)" 
                                   disabled="true" />
                </h:panelGroup>
            </p:fieldset>
            
            <p:separator />

            <p:fieldset legend="快取資料 CM_CACHE_DATA" toggleable="true" rendered="true" >
                <h:panelGroup rendered="true" >
                    <h:graphicImage library="images" name="add_milestone.png" styleClass="iconsBig" />
                    <p:outputLabel value="重新產生" />
                    <p:spacer width="2" height="5" />
                    <p:selectOneMenu value="#{su.cacheType}" >
                        <f:selectItem itemLabel="所有類型" noSelectionOption="true" />
                        <f:selectItems value="#{ui.cacheTypeOptions}" />
                    </p:selectOneMenu>
                    <p:spacer width="2" height="5" />
                    <p:outputLabel value="快取資料" />
                    <p:spacer width="2" height="5" />
                    <p:commandButton actionListener="#{su.doRefreshCache()}"
                                   onstart="return confirm('確定要重新產生快取資料嗎?');" 
                                   value="確定"
                                   oncomplete="afterCallBackHandler(xhr, status, args);" />
                </h:panelGroup>
            </p:fieldset>
            
            <p:separator />

            <p:fieldset legend="特殊設定" toggleable="true" rendered="true" >
                <h:panelGroup id="pgInternet" rendered="true" >
                    <h:graphicImage library="images" name="add_milestone.png" styleClass="iconsBig" />
                    <p:selectBooleanCheckbox value="#{su.internalOnly}" >
                        <p:ajax event="change" listener="#{su.changeInternal()}" update=":fmMain:pgInternet" />
                    </p:selectBooleanCheckbox>
                    <p:outputLabel value="啟用手機APP修改功能限制，" />
                    <p:spacer width="2" height="5" />
                    <p:outputLabel value="輸入合法內網區段："  />
                    <p:inputText size="30" value="#{su.internalIpStr}" />
                    <p:spacer width="2" height="5" />
                    <p:outputLabel value="(多個請以逗號分隔，例如 192.168.*,10.1.*.* )" />
                    
                    <p:commandButton actionListener="#{su.saveInternalIpStr()}"
                                   onstart="return confirm('確定要啟用手機APP異動功能限制內網使用嗎?');" 
                                   value="確定"
                                   oncomplete="afterCallBackHandler(xhr, status, args);" />
                </h:panelGroup>
            </p:fieldset>
            
            <!--
            <p:separator />
            <p:fieldset legend="系統公告設定" rendered="true" >
                <p:outputLabel value="開啟系統公告" />
                <p:selectBooleanCheckbox value="#{app.announcement}" >
                    <p:ajax event="change" listener="#{app.changeAnnouncement()}" process="@(this)" update=":fmMain" />
                </p:selectBooleanCheckbox>
                <br />
                <p:spacer height="5" width="2" />
                <br /> 
                <p:fileUpload fileUploadListener="#{app.handleAnnouncementUpload}" style="width:400px"
                                
                              mode="advanced"
                              update=":fmMain:otUploadResult"
                              multiple="false"
                              sizeLimit="5242880"
                              auto="true"
                              oncomplete="afterSuccess();"  
                              onerror="afterError();" 
                              label="#{msg['label.upload.selectUploadFile']}" />
                
                <h:outputText id="otUploadResult" rendered="#{!empty app.announcementFileTime}" styleClass="info" 
                              value="最近上傳時間：#{app.formatDateTime(app.announcementFileTime)}" />
            </p:fieldset>
            -->
        </h:form>
        
        <!-- BEGIN: TEST Editor
        <h:form id="fmEditor" prependId="false">    
            <h3 style="margin-top:0">Basic</h3>
            <p:textEditor widgetVar="editor1" value="#{editorView.text}" height="300" style="margin-bottom:10px"/>

            <p:commandButton value="Submit" update="display" oncomplete="PF('dlg').show()" icon="ui-icon-disk" />
            <p:commandButton value="Clear" type="button" onclick="PF('editor1').clear();" icon="ui-icon-close" />

            <h3 class="first">Custom Toolbar</h3>
            <p:textEditor widgetVar="editor2" value="#{editorView.text2}" height="300" style="margin-bottom:10px" placeholder="Enter your content">
                <f:facet name="toolbar">
                     <span class="ql-formats">
                        <button class="ql-bold"></button>
                        <button class="ql-italic"></button>
                        <button class="ql-underline"></button>
                        <button class="ql-strike"></button>
                    </span>
                    <span class="ql-formats">
                        <select class="ql-font"></select>
                        <select class="ql-size"></select>
                    </span>
                </f:facet>
            </p:textEditor>

            <p:commandButton value="Submit" update="display" oncomplete="PF('dlg').show()" icon="ui-icon-disk" />
            <p:commandButton value="Clear" type="button" onclick="PF('editor2').clear();" icon="ui-icon-close" />

            <p:dialog header="Content" widgetVar="dlg" showEffect="fade" hideEffect="fade">
                <p:outputPanel id="display">
                    <h3 style="margin-top:0">Basic</h3>
                    <h:outputText value="#{editorView.text}" escape="false" />

                    <h3>Custom</h3>
                    <h:outputText value="#{editorView.text2}" escape="false" />
                </p:outputPanel>
            </p:dialog>     
        </h:form>
        END: TEST Editor -->

        <!-- 功能權限檢查對話框 -->
        <ui:include src="/inc/inc_authorizationDlg.xhtml">
            <ui:param name="controller" value="#{su}"/>
        </ui:include>
        
    </ui:define>
</ui:composition>

/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */
package com.tcci.fc.facade.bpm;

import com.tcci.fc.entity.bpm.TcActivity;
import com.tcci.fc.entity.bpm.TcProcess;
import com.tcci.fc.entity.bpm.TcWorkitem;
import com.tcci.fc.entity.essential.Persistable;
import com.tcci.fc.entity.org.TcUser;
import java.util.Collection;
import java.util.List;
import java.util.Map;

/**
 *
 * @author Jimmy.Lee
 */
public interface IBPMEngine {
    // flow action
    public TcProcess createProcess(TcUser creator, String processname, Map<String, Object> roleUsers, String subject, Persistable primaryObj);
    public TcProcess createProcess(CreateProcessParam param);
    public void startProcess(TcProcess process);
    public void terminateProcess(TcProcess process, String comments, TcUser operator);
    public void startActivity(TcActivity activity);
    public void terminateActivity(TcActivity activity);
    public void completeWorkitem(TcWorkitem workitem, String ballot, String routeName, String comments, TcUser operator, boolean allowAgent);
    public void reassign(TcWorkitem workitem, TcUser newOwner, String comments, TcUser operator, boolean allowAgent);
    public void addActivitiesBefore(TcWorkitem workitem, List<TcUser> newUsers); // 先會,串簽
    public void addActivitiesBefore(TcWorkitem workitem, List<TcUser> newUsers, String userComment); // 先會,串簽
    public void addActivitiesBefore(TcWorkitem workitem, List<TcUser> newUsers, boolean string); // 先會, string true:串簽, false:並簽
    public void addActivitiesBefore(TcWorkitem workitem, List<TcUser> newUsers, boolean string, String userComment); // 先會, string true:串簽, false:並簽
    public void addActivitiesAfter(TcWorkitem workitem, List<TcUser> newUsers);
    public void addActivitiesAfter(TcWorkitem workitem, List<TcUser> newUsers, String userComment);
    public void addActivitiesAfter(TcWorkitem workitem, List<TcUser> newUsers, boolean string);
    public void addActivitiesAfter(TcWorkitem workitem, List<TcUser> newUsers, boolean string, String userComment);
    public void returnToPrevious(TcWorkitem workitem, String comments, TcUser operator, boolean allowAgent);
    // 簽核中的activity增加簽核人
    public void addActivityWorkitem(TcActivity activity, TcUser user);
    public void addActivityWorkitems(TcActivity activity, List<TcUser> users);
    public boolean passAllUsers(TcActivity activity, Collection<TcUser> roleUsers, List<TcWorkitem> completedWorkitems); // 有人簽過是否pass all?
    public boolean passUser(TcActivity activity, TcUser user, List<TcWorkitem> completedWorkitems); // pass簽過的人
    
    // event
    public void onStartProcess(TcProcess process);
    public void onCompleteProcess(TcProcess process);
    public void onTerminateProcess(TcProcess process);
    public void onWorkitemStartNotification(TcWorkitem workitem);
    public void onWaitingActivity(TcActivity activity);
    public void onStartActivity(TcActivity activity);
    public void onCompleteActivity(TcActivity activity, String nextRoute);
    public String onNextActivtyRoute(TcActivity activity); // 回傳下個activity route
    public String onExecuteExpressionRobot(TcActivity activity); // 回傳下個activity route
    
    // helper
    public boolean isRequireNewTransaction(BpmEventEnum eventEnum);
    public List<ProcessActivityVO> findProcessActivitiesFlow(TcProcess process, boolean taskOnly);
    public List<TcWorkitem> myRunningWorkitems(TcUser owner);
    public List<TcWorkitem> myRunningWorkitems(TcUser owner, Class clazz);
    public List<TcWorkitem> myRunningWorkitems(TcUser owner, String processname);
    public List<TcProcess> myRunningProcesses(TcUser owner);
    public List<TcProcess> myRunningProcesses(TcUser owner, Class clazz);
    public List<TcProcess> myRunningProcesses(TcUser owner, String processname);
    public List<TcWorkitem> myCompletedWorkitems(TcUser owner);
    public List<TcWorkitem> allRunningWorkitems();
    public List<TcWorkitem> allRunningWorkitems(Class clazz); // by表單class
    public List<TcWorkitem> allRunningWorkitems(String processname); // by流程名稱
    public int countRunningWorkitems(TcUser owner);
    public int countRunningWorkitems(TcUser owner, Class clazz);
    public int countRunningWorkitems(TcUser owner, String processname);
    public List<WorkitemCountVO> countRunningWorkitemsByProcess(TcUser owner);
    public List<WorkitemCountVO> countRunningWorkitemsByForm(TcUser owner);
    public TcProcess findProcess(Long id);
    public List<TcProcess> findProcess(ProcessFilter filter);
    public TcActivity findActivity(Long id);
    public TcWorkitem findWorkitem(Long id);
    public void updateActivityUsers(TcActivity activity, Object users);
    public void removeActivityUsers(TcActivity activity);
    public ReassignVO autoReassign(TcWorkitem workitem);
    
    // 批次通知running workitems
    public void batchNotifyRunningWorkitems();
    public void onBatchNotifyRunningWorkitems(TcUser owner, List<TcWorkitem> workitems);
    // 批次通知running workitems (by表單class)
    public void batchNotifyRunningWorkitems(Class clazz);
    public void onBatchNotifyRunningWorkitems(TcUser owner, List<TcWorkitem> workitems, Class clazz);
    // 批次通知running workitems (by流程名稱)
    public void batchNotifyRunningWorkitems(String processname);
    public void onBatchNotifyRunningWorkitems(TcUser owner, List<TcWorkitem> workitems, String processname);

}

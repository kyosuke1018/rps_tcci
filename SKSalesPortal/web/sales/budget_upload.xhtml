<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="../templates/generalPageTemplate.xhtml">
    <ui:define name="title">
        #{msg['menu.sales.budgetupload']}
    </ui:define>    
    <ui:define name="content">
        <h:form prependId="false" enctype="multipart/form-data">
            <p:panel header="#{msg['menu.sales.budgetupload']}">
                <p:fieldset legend="#{msg['upload.budget']}:">
                    <h:panelGrid columns="1" width="60%">
                        <h:panelGroup>
                            <h:outputLabel styleClass="required" value="#{msg['upload.overdue.ar.file']}:"/>
                            <p:fileUpload mode="simple"
                                        value="#{uploadBudgetController.uploadedFile}"
                                        allowTypes="/(\.|\/)(xls)$/"/>    
                             <h:outputLink value="../templates/excel/SalesBudgetUploadTemplate.xls" style="margin-left: 10px">
                                 <h:outputText value="下載範本"/>
                             </h:outputLink>    
                         </h:panelGroup>
                    </h:panelGrid>
                    <h:panelGrid columns="1" width="60%">
                        <h:panelGroup>
                            <p:commandButton ajax="false" action="#{uploadBudgetController.doUploadBudgetData}" value="#{msg['button.upload']}" update="tempfile"/>
                        </h:panelGroup>                           
                    </h:panelGrid>                    
                </p:fieldset>      
                <p:fieldset legend="#{msg['upload.budget.tempfile']}:">
                    <p:dataTable id="tempfile"
                                 value="#{uploadBudgetController.uploadedBudgetList}"
                                 var="row"
                                 rowStyleClass="#{not empty row.errorMsg ? 'row_error' : null}"
                                 rowIndexVar="rowIndex"
                                 rows="10" 
                                 paginator="true">                    
                        <p:column>
                            <f:facet name="header">Key</f:facet> 
                            <h:outputText value="BUDGET"/>
                        </p:column>
                        <p:column headerText="#{msg['sales.group']}" filterBy="#{row.sapId}" filterMatchMode="contains">                           
                            <h:outputText value="#{row.sapId}"/>
                        </p:column>
                        <p:column headerText="#{msg['sales.name']}"  filterBy="#{row.salesName}" filterMatchMode="contains">                            
                            <h:outputText value="#{row.salesName}"/>
                        </p:column>
                        <p:column headerText="#{msg['yy']}" filterBy="#{row.year}" filterMatchMode="contains">                           
                            <h:outputText value="#{row.year}"/>
                        </p:column>  
                        <p:column headerText="#{msg['mm']}" filterBy="#{row.month}" filterMatchMode="contains">                           
                            <h:outputText value="#{row.month}"/>
                        </p:column>                      
                        <p:column>
                            <f:facet name="header">#{msg['budget']}</f:facet> 
                            <h:outputText value="#{row.budget}"/>
                        </p:column>  
                        <p:column style="text-align: left">
                            <f:facet name="header">#{msg['common.label.errorMessage']}</f:facet> 
                            <ui:repeat value="#{row.errorMsg}" var="errorMsg"> 
                                。<h:outputText value="#{errorMsg}"/><br/>
                            </ui:repeat>                           
                        </p:column>                         
                    </p:dataTable>
                    <br/>
                    <p:commandButton value="#{msg['button.save']}" action="#{uploadBudgetController.confirmUpload}" 
                                     disabled="#{uploadBudgetController.hasError or empty uploadBudgetController.uploadedBudgetList}" 
                                     update="messages"/>
                </p:fieldset>
            </p:panel>            
        </h:form>        
    </ui:define>
</ui:composition>

<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui">
    <p:fieldset legend="#{msg['remitmaintenance.customer.info']}:">
        <h:panelGrid columns="3" width="100%">
            <h:panelGroup>
                <h:outputLabel for="customerCode" value="#{msg['customer.code']}:" style="margin-right: 10px"/>
                <h:outputText id="customerCode" value="#{editPaymentDetailController.skCustomer.displayIdentifier}"/>
            </h:panelGroup>
            <h:panelGroup>
                <h:outputLabel for="salesGroup" value="#{msg['sales.group']}:" style="margin-right: 10px"/>
                <h:outputText id="salesGroup" value="#{editPaymentDetailController.skSales.displayIdentifier}"/>
            </h:panelGroup>                        
            <h:panelGroup>
                <h:outputLabel for="paymentdate" value="#{msg['payment.date']}:" style="margin-right: 10px"/>
                <h:outputText id="paymentdate" value="#{editPaymentDetailController.today}">
                    <f:convertDateTime pattern="yyyy/MM/dd"/>
                </h:outputText>    
            </h:panelGroup>    
        </h:panelGrid>                    
    </p:fieldset>
    <p:fieldset legend="#{msg['remitmaintenance.payment.detail']}:" id="detailField">
        <h:panelGrid columns="2" width="90%">
            <h:panelGroup>
                <h:outputLabel for="cashTotal" value="#{msg['remitmaintenance.cash.total']}:" style="margin-right: 10px"/>
                <p:inputText id="cashTotal" size="20" value="#{editPaymentDetailController.cashTotal}"
                             validatorMessage="#{msg['remitmaintenance.cash.total']}#{msg['msg.number.should.be.positive']}"
                             converterMessage="#{msg['remitmaintenance.cash.total']}#{msg['msg.number.should.be.number']}">
                    <f:validateLongRange minimum="0"/>
                    <!--                        <p:ajax event="keyup" update="messages growl"/>-->
                </p:inputText>    
                (
                <h:outputLabel for="remitBank" value="#{msg['remitmaintenance.remit.bank']}:" style="margin-right: 10px"/>
                <h:selectOneMenu id="remitBank" value="#{editPaymentDetailController.skArRemitMaster.bank}" style="white-space:nowrap;">
                    <f:selectItems value="#{editPaymentDetailController.bankList}" var="bank" itemLabel="#{bank.displayName}" itemValue="#{bank}"/>
                </h:selectOneMenu>
                )
            </h:panelGroup>                      
            <h:panelGroup/>
            <h:panelGroup>
                <h:outputLabel for="checkTotal" value="#{msg['remitmaintenance.check.total']}:" style="margin-right: 10px"/>
                <p:inputText id="checkTotal" size="20" value="#{editPaymentDetailController.checkTotal}"
                             validatorMessage="#{msg['remitmaintenance.check.total']}#{msg['msg.number.should.be.positive']}"
                             converterMessage="#{msg['remitmaintenance.check.total']}#{msg['msg.number.should.be.number']}">
                    <f:validateLongRange minimum="0"/>
                    <!--                        <p:ajax event="keyup" update="messages growl"/>-->
                </p:inputText>                                         
            </h:panelGroup>                      
            <h:panelGrid columns="3" style="text-align:right;">
                <h:outputLabel value="#{msg['remitmaintenance.advance.receipts.A.total']}:" style="margin-right: 10px"/>
                <h:outputText value="#{editPaymentDetailController.advancedReceiptsA}" id="advanceReceiptA">
                    <f:convertNumber groupingUsed="true"/>
                </h:outputText>
                <h:panelGroup rendered="#{editPaymentDetailController.advancedReceiptsA eq 0}"/>
                <p:commandLink value="#{msg['common.label.detail']}"
                               action="#{editPaymentDetailController.changeAdvancedReceiptList('A',editPaymentDetailController.advancedReceiptsAList)}"
                               update="viewAdvancedReceiptsDialog advancedReceiptsGroup"
                               rendered="#{editPaymentDetailController.advancedReceiptsA ne 0}"
                               oncomplete="PF('viewAdvancedReceiptsDialog').show()"/>
                <h:outputLabel value="#{msg['remitmaintenance.advance.receipts.J.total']}:" style="margin-right: 10px"/>
                <h:outputText value="#{editPaymentDetailController.advancedReceiptsJ}" id="advanceReceiptJ">
                    <f:convertNumber groupingUsed="true"/>
                </h:outputText>
                <h:panelGroup>
                    <p:spacer width="5px" height="1px"/>
                    <p:commandLink value="#{msg['common.label.detail']}"
                                   action="#{editPaymentDetailController.changeAdvancedReceiptList('J',editPaymentDetailController.advancedReceiptsJList)}"
                                   update="viewAdvancedReceiptsDialog advancedReceiptsGroup"
                                   rendered="#{editPaymentDetailController.advancedReceiptsJ ne 0}"
                                   oncomplete="PF('viewAdvancedReceiptsDialog').show()"/>
                </h:panelGroup>
            </h:panelGrid>                        
        </h:panelGrid>
        <p:dataTable id="paymentDetail" rowStyleClass="rowstyle"
                     value="#{editPaymentDetailController.skArRemitItemList}"                                                                 
                     var="item" rowIndexVar="rownumber">
            <f:facet name="header">  
                <p:commandButton value="#{msg['remitmaintenance.add.orderNumber']}" 
                                 immediate="true"
                                 disabled="#{flash.viewOnly}"
                                 oncomplete="PF('selectOrderNumberDlg').show();return false;" 
                                 update="selectOrderNumberForm"
                                 icon="ui-icon-plus"/>
            </f:facet> 
            <p:column headerText="#{msg['column.order.number']}" style="white-space:nowrap"> 
                <h:outputText value="#{item.orderNumber}"/>
            </p:column>        
            <p:column headerText="#{msg['column.invoice.number.date']}" style="white-space:nowrap"> 
                <h:outputText value="#{item.invoiceNumber}"/><br/>
                (<h:outputText value="#{item.invoiceTimestamp}">
                    <f:convertDateTime pattern="yyyy/MM/dd"/> 
                </h:outputText>)
            </p:column>
            <p:column headerText="#{msg['column.account.receivable']}" style="text-align:right;white-space:nowrap"> 
                <h:outputText value="#{item.arAmount}">
                    <f:convertNumber groupingUsed="true"/>
                </h:outputText>                        
                <h:inputHidden id="arAmount" value="#{item.arAmount}"/>
            </p:column> 
            <p:column headerText="#{msg['column.premium.discount']}" style="white-space:nowrap"> 
                <h:outputText value="#{item.premiumDiscount eq null ? 0 : item.premiumDiscount}">
                    <f:convertNumber groupingUsed="true"/>
                </h:outputText>
                <h:inputHidden id="premiumDiscount" value="#{item.premiumDiscount}"/>
            </p:column> 
            <p:column headerText="#{msg['column.sales.allowances']}" style="white-space:nowrap"> 
                <p:inputText onselect="this.focus()" onkeyup="remitCalc(#{rownumber});
                        calcColumnTotal('salesDiscount');" id="salesDiscount" value="#{item.salesDiscount}" size="4" rendered="#{item.arAmount ge 0}"
                             validatorMessage="#{msg['sales.allowances']}#{msg['msg.number.should.be.positive']}"
                             converterMessage="#{msg['sales.allowances']}#{msg['msg.number.should.be.number']}">
                    <f:validateLongRange minimum="0"/>
                    <p:ajax event="blur" update="messages growl"/>
                </p:inputText>        
            </p:column> 
            <p:column headerText="#{msg['column.sales.return']}" style="white-space:nowrap"> 
                <p:inputText onkeyup="remitCalc(#{rownumber});
                        calcColumnTotal('salesReturn');" id="salesReturn" value="#{item.salesReturn}" size="4" rendered="#{item.arAmount ge 0}"
                             validatorMessage="#{msg['sales.return']}#{msg['msg.number.should.be.positive']}"
                             converterMessage="#{msg['sales.return']}#{msg['msg.number.should.be.number']}">
                    <f:validateLongRange minimum="0"/>
                    <p:ajax event="blur" update="messages growl"/>
                </p:inputText>    
            </p:column>                             
            <p:column headerText="#{msg['negative.ar']}" style="white-space:nowrap"> 
                <p:inputText onkeyup="remitCalc(#{rownumber});
                        calcColumnTotal('negativeAr');" id="negativeAr" value="#{item.negativeAr}" size="4" rendered="#{item.arAmount ge 0}"
                             validatorMessage="#{msg['negative.ar']}#{msg['msg.number.should.be.positive']}"
                             converterMessage="#{msg['negative.ar']}#{msg['msg.number.should.be.number']}">
                    <f:validateLongRange minimum="0"/>
                    <p:ajax event="blur" update="messages growl"/>
                </p:inputText>       
            </p:column> 
            <p:column headerText="#{msg['column.quantity.tolerance']}" style="white-space:nowrap"> 
                <p:inputText onkeyup="remitCalc(#{rownumber});
                        calcColumnTotal('differenceCharge');" id="differenceCharge" value="#{item.differenceCharge}" size="3" rendered="#{item.arAmount ge 0}"
                             validatorMessage="#{msg['quantity.tolerance']}#{msg['msg.number.should.be.positive.less.than.99']}"
                             converterMessage="#{msg['quantity.tolerance']}#{msg['msg.number.should.be.number']}">
                    <f:validateLongRange minimum="0" maximum="99"/>
                    <p:ajax event="blur" update="messages growl"/>
                </p:inputText>       
            </p:column> 
            <p:column style="white-space:nowrap"> 
                <f:facet name="header">
                    <h:outputLabel value="#{msg['advance.receipts']}(A)"/><br/>
                    <h:outputLabel value="#{msg['advance.receipts']}(J)"/>
                </f:facet>
                <p:inputText onkeyup="remitCalc(#{rownumber});
                        calcColumnTotal('itemAdvanceReceiptA');" id="itemAdvanceReceiptA" value="#{item.advanceReceiptsA}" size="5" rendered="#{item.arAmount ge 0}"
                             validatorMessage="#{msg['advance.receipts']}(A)#{msg['msg.number.should.be.positive']}" 
                             converterMessage="#{msg['advance.receipts']}(A)#{msg['msg.number.should.be.number']}"
                             disabled="#{editPaymentDetailController.advancedReceiptsA lt 0}">
                    <f:validateLongRange minimum="0"/>
                    <p:ajax event="blur" update="messages growl"/>
                </p:inputText>  
                <br />
                <p:inputText onkeyup="remitCalc(#{rownumber});
                        calcColumnTotal('itemAdvanceReceiptJ');" id="itemAdvanceReceiptJ" value="#{item.advanceReceiptsJ}" size="5" rendered="#{item.arAmount ge 0}"
                             validatorMessage="#{msg['advance.receipts']}(J)#{msg['msg.number.should.be.positive']}" 
                             converterMessage="#{msg['advance.receipts']}(J)#{msg['msg.number.should.be.number']}"
                             disabled="#{editPaymentDetailController.advancedReceiptsJ lt 0}">
                    <f:validateLongRange minimum="0"/>
                    <p:ajax event="blur" update="messages growl"/>
                </p:inputText>        
            </p:column> 
            <p:column headerText="#{msg['column.remit.amount']}" style="text-align:right;white-space:nowrap">
                <h:outputText id="amount" rendered="#{item.arAmount ge 0}" value="#{item.amount}">
                    <f:convertNumber groupingUsed="true"/>
                </h:outputText>    
                <h:inputHidden id="amountHidden" rendered="#{item.arAmount ge 0}" value="#{item.amount}"/>              
                <br/><p:spacer  width="0px" height="10px"/>
                <p:inputText id="amount2" onkeyup="remitCalc(#{rownumber});" rendered="#{item.arAmount ge 0}" value="#{item.amount2}" size="5"/>        
            </p:column> 
            <p:column headerText="#{msg['column.payment.way']}" style="white-space:nowrap"> 
                <h:selectOneMenu onchange="remitCalc(#{rownumber});" id="paymentType" value="#{item.paymentType}" style="white-space:nowrap;" rendered="#{item.arAmount ge 0}">
                    <f:selectItems value="#{editPaymentDetailController.paymentTypeList}" var="pType" itemLabel="#{pType.displayName}" itemValue="#{pType}"/>
                </h:selectOneMenu>
                <br/><p:spacer width="0px" height="17px"/>                   
                <h:selectOneMenu onchange="remitCalc(#{rownumber});" id="paymentType2" value="#{item.paymentType2}" style="white-space:nowrap;" rendered="#{item.arAmount ge 0}">
                    <f:selectItems value="#{editPaymentDetailController.paymentTypeList}" var="pType" itemLabel="#{pType.displayName}" itemValue="#{pType}"/>
                </h:selectOneMenu>                
            </p:column> 
            <p:column headerText="#{msg['column.check.number']}" style="white-space:nowrap"> 
                <p:inputText id="checkNumber" value="#{item.checkNumber}" size="7" rendered="#{item.arAmount ge 0}"/>
                <p:spacer width="2px"/>
                <p:commandButton oncomplete="PF('viewCheckDialog').show();" update="viewCheckDialog"
                                 action="#{editCheckDialogController.goEdit(item.checkNumber)}" 
                                 icon="ui-icon-gear" title="#{msg['view.check']}" style="width:10px;height: 10px"
                                 rendered="#{includeFrom eq 'confirmRemit' and item.arAmount ge 0}" />                                 
                <br/><p:spacer width="0px" height="10px"/>                    
                <p:inputText id="checkNumber2" value="#{item.checkNumber2}" size="7" rendered="#{item.arAmount ge 0}"/>
                <p:spacer width="2px"/>
                <p:commandButton oncomplete="PF('viewCheckDialog').show();" update="viewCheckDialog"
                                 action="#{editCheckDialogController.goEdit(item.checkNumber2)}" 
                                 icon="ui-icon-gear" title="#{msg['view.check']}" style="width:10px;height: 10px"
                                 rendered="#{includeFrom eq 'confirmRemit' and item.arAmount ge 0}" />                                      
            </p:column> 
            <p:column headerText="#{msg['column.action']}" style="white-space:nowrap"> 
                <p:commandButton immediate="true" 
                                 onclick="PF('confirmation').show();" 
                                 disabled="#{flash.viewOnly}"
                                 action="#{editPaymentDetailController.setNeedDeleteItem(item)}"
                                 icon="ui-icon-trash"
                                 title="#{msg['button.remove']}"/>
            </p:column>
        </p:dataTable>
        <h:panelGrid columns="8" width="100%" style="text-align:right;">
            <h:outputLabel for="salesDiscountTotal" value="#{msg['remitmaintenance.sales.allowance']}#{msg['common.label.total']}:"/>
            <h:outputText id="salesDiscountTotal" value="0"/>
            <h:outputLabel for="salesReturnTotal" value="#{msg['remitmaintenance.sales.return']}#{msg['common.label.total']}:"/>
            <h:outputText id="salesReturnTotal" value="0"/>
            <h:outputLabel for="negativeArTotal" value="#{msg['remitmaintenance.sales.negativear']}#{msg['common.label.total']}:"/>
            <h:outputText id="negativeArTotal" value="0"/>
            <h:outputLabel for="differenceChargeTotal" value="#{msg['remitmaintenance.sales.tolerance']}#{msg['common.label.total']}:"/>
            <h:outputText id="differenceChargeTotal" value="0"/>
            <h:outputLabel for="itemAdvanceReceiptATotal" value="#{msg['advance.receipts']}(A)#{msg['common.label.total']}:"/>
            <h:outputText id="itemAdvanceReceiptATotal" value="0"/>
            <h:outputLabel for="itemAdvanceReceiptJTotal" value="#{msg['advance.receipts']}(J)#{msg['common.label.total']}:"/>
            <h:outputText id="itemAdvanceReceiptJTotal" value="0"/>
            <h:panelGroup/>
            <h:panelGroup/>
            <h:panelGroup/>
            <h:panelGroup/>
            <h:outputLabel for="cashRemitTotal" value="#{msg['remitmaintenance.cash.remit.total']}:"/>
            <h:panelGroup>
                <h:outputText id="cashRemitTotal" value="#{editPaymentDetailController.skArRemitMaster.remittanceAmount}">
                    <f:convertNumber groupingUsed="true"/>
                </h:outputText>    
                <h:inputHidden id="cashRemitTotalHidden" value="#{editPaymentDetailController.skArRemitMaster.remittanceAmount}"/>
            </h:panelGroup>
            <h:outputLabel for="checkRemitTotal" value="#{msg['remitmaintenance.check.remit.total']}:"/>
            <h:panelGroup>
                <h:outputText id="checkRemitTotal" value="#{editPaymentDetailController.skArRemitMaster.checkAmount}">   
                    <f:convertNumber groupingUsed="true"/>
                </h:outputText>    
                <h:inputHidden id="checkRemitTotalHidden" value="#{editPaymentDetailController.skArRemitMaster.checkAmount}"/>                      
            </h:panelGroup>
        </h:panelGrid>     
        <br/>
    </p:fieldset>         
    <p:confirmDialog style="vertical-align: middle" header="#{msg['remitmaintenance.remove.remititem']}" message="#{msg['remitmaintenance.confirm.remove.remititem']}" widgetVar="confirmation">
        <p:spacer width="45px" height="1px"/>
        <p:commandButton value="#{msg['button.ok']}" update="messages growl detailField" oncomplete="calcTotal();reCalcColumnTotal();PF('confirmation').hide()" immediate="true"
                         actionListener="#{editPaymentDetailController.removeSkArRemitItem}"/>  
        <p:commandButton value="#{msg['button.cancel']}" onclick="PF('confirmation').hide();" type="button" immediate="true"/>               
    </p:confirmDialog>			
    <h:outputScript library="js" name="remitCalc.js"/>      
    <script language="javascript">
        //<![CDATA[
        function reCalcColumnTotal() {
            var detailLength = '#{editPaymentDetailController.skArRemitItemList.size()}';
            for (i = 0; i < detailLength; i++) {
                remitCalc(i);
            }
            calcColumnTotal('salesDiscount');
            calcColumnTotal('salesReturn');
            calcColumnTotal('negativeAr');
            calcColumnTotal('differenceCharge');
            calcColumnTotal('itemAdvanceReceiptA');
            calcColumnTotal('itemAdvanceReceiptJ');
        }
        reCalcColumnTotal();
        //]]>
    </script>
</ui:composition>


<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="../templates/generalPageTemplate.xhtml">
    <ui:define name="title">
        #{msg['menu.admin.sales.org.list']}
    </ui:define>    
    <ui:define name="content">
        <p:layout style="height:450px;" id="layout">
            <p:layoutUnit position="west" size="100" minSize="250" maxSize="250" resizable="true" closable="true" collapsible="true">
                <h:form id="channel">  
                    <h:outputText value="#{msg['sales.channel.tree.title']}" style="line-height: 200%"/>
                    <p:tree value="#{salesOrgListController.salesChannelRoot}" var="node" id="channelTree"
                           selectionMode="single"  
                           selection="#{salesOrgListController.selectedNode}"  
                           cache="true">  
                        <p:ajax event="select" listener="#{salesOrgListController.onNodeSelect}" update=":member:orgInfo"/>
                        <p:treeNode>                                    
                            <h:outputText value="#{node.displayIdentifier}" />  
                        </p:treeNode>  
                    </p:tree>  
                    
                    <p:contextMenu for="channelTree">
                        <p:menuitem value="#{msg['sales.add.sub.channel']}" action="#{crudChannelController.setSelectedChannel(salesOrgListController.selectedSalesChannel, true)}" update=":crudForm:crudDialog" oncomplete="PF('crudChannelDlg').show();return false;" icon="ui-icon-circle-plus" />
                        <p:menuitem value="#{msg['sales.edit.channel']}" action="#{crudChannelController.setSelectedChannel(salesOrgListController.selectedSalesChannel, false)}" update=":crudForm:crudDialog" oncomplete="PF('crudChannelDlg').show();return false;" icon="ui-icon-circle-triangle-e" />
                        <p:menuitem value="#{msg['sales.delete.channel']}" icon="ui-icon-circle-minus" action="#{salesOrgListController.checkChildAndMember}" update=":channel:confirmDialog" oncomplete="PF('confirmation').show();return false;"/>
                    </p:contextMenu>
                    
                    <p:confirmDialog id="confirmDialog" message="#{salesOrgListController.hasChildOrMember ? msg['sales.channel.cannot.delete'] : msg['sales.channel.delete.alert']}"  
                                    header="#{msg['sales.delete.channel']}" severity="alert" widgetVar="confirmation">                            
                        <p:commandButton id="confirm" value="#{msg['button.ok']}" oncomplete="PF('confirmation').hide();"
                                            action="#{salesOrgListController.deleteChannel}"
                                            update=":channel:channelTree" rendered="#{not salesOrgListController.hasChildOrMember}"/>
                        <p:commandButton id="cancel" value="#{msg['button.cancel']}" onclick="PF('confirmation').hide();" />                        
                    </p:confirmDialog>                    
                </h:form>
            </p:layoutUnit>

            <p:layoutUnit position="center">
                <h:form id="member">
                    <h:outputText value="#{msg['sales.member.list.title']}" style="line-height: 200%; margin-right: 10px"/>
                    <p:commandButton value="#{msg['sales.add.member']}" action="#{salesOrgListController.addNewSelectedSalesMember}"
                                     oncomplete="PF('editMemberDlg').show();return false;" icon="ui-icon-plus" update=":editMemberForm:editMemberDlg"/><br/><br/>
                    <p:dataTable id="orgInfo" value="#{salesOrgListController.salesMemberList}" var="row">
                        <p:column headerText="#{msg['sales.member.code']}">
                            <h:outputText value="#{row.code}"/>
                        </p:column>
                        <p:column  headerText="#{msg['sales.member.user']}">
                            <h:outputText value="#{row.member.displayIdentifier}"/>
                        </p:column>
                        <p:column headerText="#{msg['sales.member.selectable']}">
                            <h:outputText value="#{row.selectable}"/>
                        </p:column>
                        <p:column headerText="#{msg['column.action']}">
                            <p:commandButton value="#{msg['button.edit']}" action="#{salesOrgListController.refreshSelectedSalesMember(row)}" 
                                             oncomplete="PF('editMemberDlg').show();return false;" update=":editMemberForm:editMemberDlg"/>                         
                        </p:column>
                    </p:dataTable>
                </h:form>
            </p:layoutUnit>
        </p:layout>
        <ui:include src="../jsff/crudChannelDlg.xhtml">                      
            <ui:param name="nameForUpdate" value=":channel:channelTree :member"/>
        </ui:include>    
        <ui:include src="../jsff/editMemberDlg.xhtml"/>  
        <ui:include src="../jsff/selectEmployeeDialog.xhtml">
            <ui:param name="empidId" value="member_empId"/>
            <ui:param name="empnameId" value="member_cname"/>
        </ui:include>
        <ui:include src="../jsff/ajaxStatusDlg.xhtml"/>
    </ui:define>    
</ui:composition>
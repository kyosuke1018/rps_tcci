--SK交易VIEW業代日結
SELECT     TOP (100) PERCENT dbo.業代工作日期.年, dbo.業代工作日期.月, dbo.業代工作日期.工作日期, dbo.SK業代VIEW.配銷通路名稱, 
                      dbo.SK業代VIEW.業代代號, dbo.SK業代VIEW.姓名, dbo.SK業代VIEW.銷售群組, dbo.SK交易VIEW業代銷貨日結.發票金額, 
                      CASE WHEN dbo.SK交易VIEW業代銷貨日結.事前溢折 IS NULL THEN 0 ELSE dbo.SK交易VIEW業代銷貨日結.事前溢折 END AS 事前溢折, 
                      dbo.SK交易VIEW業代銷貨日結.成本, CASE WHEN dbo.SK交易VIEW業代退貨日結.退貨金額 IS NULL 
                      THEN 0 ELSE dbo.SK交易VIEW業代退貨日結.退貨金額 END AS 退貨金額, dbo.SK業代每日預算VIEW.每月預算, dbo.SK業代每日預算VIEW.天數, 
                      dbo.SK業代每日預算VIEW.每日預算, CASE WHEN dbo.SK交易VIEW業代事後折讓日結.事後折讓金額 IS NULL 
                      THEN 0 ELSE dbo.SK交易VIEW業代事後折讓日結.事後折讓金額 END AS 事後折讓金額
FROM         dbo.SK業代每日預算VIEW INNER JOIN
                      dbo.業代工作日期 ON dbo.SK業代每日預算VIEW.年 = dbo.業代工作日期.年 AND dbo.SK業代每日預算VIEW.月 = dbo.業代工作日期.月 INNER JOIN
                      dbo.SK業代VIEW ON dbo.SK業代每日預算VIEW.SODID = dbo.SK業代VIEW.SODID LEFT OUTER JOIN
                      dbo.SK交易VIEW業代事後折讓日結 ON dbo.SK業代VIEW.銷售群組 = dbo.SK交易VIEW業代事後折讓日結.銷售群組 AND 
                      dbo.業代工作日期.工作日期 = dbo.SK交易VIEW業代事後折讓日結.訂單日期 LEFT OUTER JOIN
                      dbo.SK交易VIEW業代退貨日結 ON dbo.SK業代VIEW.銷售群組 = dbo.SK交易VIEW業代退貨日結.銷售群組 AND 
                      dbo.業代工作日期.工作日期 = dbo.SK交易VIEW業代退貨日結.訂單日期 LEFT OUTER JOIN
                      dbo.SK交易VIEW業代銷貨日結 ON dbo.SK業代VIEW.銷售群組 = dbo.SK交易VIEW業代銷貨日結.銷售群組 AND 
                      dbo.業代工作日期.工作日期 = dbo.SK交易VIEW業代銷貨日結.發票日期
ORDER BY dbo.SK業代VIEW.銷售群組

--SK交易VIEW業代銷貨日結
SELECT     發票日期, SUM(未稅金額) AS 發票金額, 銷售群組, SUM(溢價折讓金額) AS 事前溢折, SUM(成本) AS 成本
FROM         dbo.SK交易VIEW銷貨
GROUP BY 發票日期, 銷售群組

--SK交易VIEW銷貨
SELECT     SKSALEID, 請款類型, 請款文件, 發票號碼, 發票日期, 付款人, 買方, 發票金額, 銷售組織, 配銷通路, 結清日期, 請款項目, 上層項目, 銷售群組, 物料號碼, 
                      儲存地點, 批號, 銷售單位, 數量, 單價, 金額, 項目種類, ROUND(溢價折讓金額, 0) AS 溢價折讓金額, ROUND(溢價折讓稅額, 0) AS 溢價折讓稅額, 成本, 
                      訂單號碼, 訂單項次, 出貨單號, 出貨項次, VBELN2, 訂單類型, 訂單日期, AUART, 合約號碼, 業務代號, ERDAT, 付款客戶, 買方客戶, 物料英文, 內文, 
                      未稅金額, 稅金
FROM         dbo.SK交易VIEW
WHERE     (LEFT(請款類型, 2) = N'ZF') OR
                      (LEFT(請款類型, 2) = N'ZL')
					  
--SK交易VIEW
SELECT     TOP (100) PERCENT dbo.ZVBRK.SKSALEID, dbo.ZVBRK.FKART AS 請款類型, dbo.ZVBRK.VBELN AS 請款文件, RTRIM(dbo.ZVBRK.XBLNR) 
                      AS 發票號碼, CASE WHEN PSTYV = 'ZTNN' THEN '' ELSE CONVERT(smalldatetime, LEFT(FKDAT, 4) + '/' + SUBSTRING(FKDAT, 5, 2) 
                      + '/' + SUBSTRING(FKDAT, 7, 2)) END AS 發票日期, SUBSTRING(dbo.ZVBRK.KUNRG, 5, 6) AS 付款人, SUBSTRING(dbo.ZVBRK.KUNAG, 5, 6) AS 買方, 
                      dbo.ZVBRK.NETWR AS 發票金額, dbo.ZVBRK.VKORG AS 銷售組織, dbo.ZVBRK.VTWEG AS 配銷通路, dbo.ZVBRK.AUGDT AS 結清日期, 
                      dbo.ZVBRK.POSNR AS 請款項目, dbo.ZVBRK.UEPOS AS 上層項目, dbo.ZVBRK.VKGRP AS 銷售群組, dbo.ZVBRK.MATNR AS 物料號碼, 
                      dbo.ZVBRK.LGORT AS 儲存地點, dbo.ZVBRK.CHARG AS 批號, dbo.ZVBRK.VRKME AS 銷售單位, dbo.ZVBRK.FKIMG AS 數量, 
                      CASE WHEN dbo.SK客戶VIEW.KALKS = '1' THEN dbo.ZVBRK.KBETR ELSE dbo.ZVBRK.KBETR * 1.05 END AS 單價, 
                      CASE WHEN dbo.SK客戶VIEW.KALKS = '1' THEN dbo.ZVBRK.NETWR1 ELSE dbo.ZVBRK.NETWR1 * 1.05 END AS 金額, 
                      dbo.ZVBRK.PSTYV AS 項目種類, dbo.ZVBRK.NETWR2 AS 溢價折讓金額, dbo.ZVBRK.MWSBP AS 溢價折讓稅額, dbo.ZVBRK.WAVWR AS 成本, 
                      dbo.ZVBRK.AUBEL AS 訂單號碼, dbo.ZVBRK.AUPOS AS 訂單項次, dbo.ZVBRK.VGBEL2 AS 出貨單號, dbo.ZVBRK.VGPOS AS 出貨項次, 
                      dbo.ZVBRK.VBELN2, dbo.ZVBRK.POSNR2 AS 訂單類型, CONVERT(smalldatetime, LEFT(dbo.ZVBRK.AUDAT, 4) + '/' + SUBSTRING(dbo.ZVBRK.AUDAT, 
                      5, 2) + '/' + SUBSTRING(dbo.ZVBRK.AUDAT, 7, 2)) AS 訂單日期, dbo.ZVBRK.AUART, dbo.ZVBRK.VGBEL AS 合約號碼, dbo.ZVBRK.PERNR AS 業務代號, 
                      dbo.ZVBRK.ERDAT, dbo.SK客戶VIEW.NAME1 AS 付款客戶, SK客戶VIEW_1.NAME1 AS 買方客戶, dbo.SK物料VIEW.物料英文, 
                      dbo.ZVBRK.LTEXT AS 內文, dbo.ZVBRK.NETWR3 AS 未稅金額, dbo.ZVBRK.MWSBP3 AS 稅金, dbo.ZVBRK.AUGRU AS 退貨原因, 
                      dbo.ZVBRK.RETURN_RATE AS 退貨倍數, dbo.ZVBRK.CHECK_DATE AS 審核日期, dbo.ZVBRK.CHECK_ID AS 審核人員
FROM         dbo.ZVBRK INNER JOIN
                      dbo.SK客戶VIEW ON dbo.ZVBRK.KUNRG = dbo.SK客戶VIEW.KUNNR INNER JOIN
                      dbo.SK客戶VIEW AS SK客戶VIEW_1 ON dbo.ZVBRK.KUNAG = SK客戶VIEW_1.KUNNR LEFT OUTER JOIN
                      dbo.SK物料VIEW ON dbo.ZVBRK.MATNR = dbo.SK物料VIEW.物料號碼

					  
--SK交易VIEW事前折讓
SELECT     銷售群組, 請款文件, 訂單號碼, 發票號碼, 發票日期, 發票金額, SUM(溢價折讓金額) AS 溢折金額, SUM(溢價折讓稅額) AS 溢折稅額, 買方, 
                      買方客戶
FROM         dbo.SK交易VIEW
WHERE     (LEFT(請款類型, 2) LIKE '%zf%')
GROUP BY 發票號碼, 請款文件, 發票日期, 發票金額, 訂單號碼, 銷售群組, 買方, 買方客戶
HAVING      (發票日期 >= CONVERT(DATETIME, '2009-01-01 00:00:00', 102))


--SK交易VIEW事後折讓
SELECT     SKSALEID, 請款類型, 請款文件, 發票號碼, 發票日期, 付款人, 買方, 發票金額, 銷售組織, 配銷通路, 結清日期, 請款項目, 上層項目, 銷售群組, 物料號碼, 
                      儲存地點, 批號, 銷售單位, 數量, 單價, 金額, 項目種類, 成本, 訂單號碼, 訂單項次, 出貨單號, 出貨項次, VBELN2, 訂單類型, 訂單日期, AUART, 合約號碼, 
                      業務代號, ERDAT, 付款客戶, 買方客戶, 物料英文, 未稅金額 AS 溢價折讓金額, 稅金 AS 溢價折讓稅額, 內文
FROM         dbo.SK交易VIEW
WHERE     (LEFT(請款類型, 2) LIKE 'zg')


--SK交易VIEW退貨
SELECT     SKSALEID, 請款類型, 請款文件, 發票號碼, 發票日期, 付款人, 買方, 發票金額, 銷售組織, 配銷通路, 結清日期, 請款項目, 上層項目, 銷售群組, 物料號碼, 
                      儲存地點, 批號, 銷售單位, 數量, 單價, 金額, 項目種類, ROUND(溢價折讓金額, 0) AS 溢價折讓金額, ROUND(溢價折讓稅額, 0) AS 溢價折讓稅額, 成本, 
                      訂單號碼, 訂單項次, 出貨單號, 出貨項次, VBELN2, 訂單類型, 訂單日期, AUART, 合約號碼, 業務代號, ERDAT, 付款客戶, 買方客戶, 物料英文, 內文, 
                      未稅金額, 稅金, 退貨原因, 退貨倍數, 審核日期, 審核人員
FROM         dbo.SK交易VIEW
WHERE     (請款類型 = N'ZRE') AND (數量 <> 0) OR
                      (請款類型 = N'ZRE') AND (金額 <> 0)
					  

--SK交易VIEW業代退貨日結
SELECT     發票日期 AS 訂單日期, 銷售群組, SUM(未稅金額) AS 退貨金額, SUM(成本) AS 退貨成本, SUM(未稅金額 * 退貨倍數) AS 退貨金額2
FROM         dbo.SK交易VIEW退貨
GROUP BY 銷售群組, 發票日期
<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="../templates/generalPageTemplate.xhtml">
    <ui:define name="title">
        #{msg['menu.assistant.applySalesAllowances']}
    </ui:define>    
    <ui:define name="content">
        <h:form id="applySalesAllowancesForm" prependId="false">
            <p:panel header="#{msg['menu.assistant.applySalesAllowances']}">
                <p:fieldset legend="#{msg['search.criteria']}:">
                    <h:panelGrid columns="4" style="width:100%">
                        <h:outputLabel for="salesGroup" value="#{msg['salesAllowances.label.sales']}:" styleClass="required"/>
                        <h:selectOneMenu value="#{applySalesAllowancesController.salesMember}" 
                                         converter="skSalesMemberConverter"
                                         required="true" 
                                         requiredMessage="#{msg['remitmaintenance.msg.sales.group.is.required']}"
                                         disabled="#{!queryCriteriaController.salesSelectable}" 
                                         id="salesGroup" 
                                         style="vertical-align:bottom;white-space:nowrap;" >
                            <f:selectItems value="#{queryCriteriaController.salesList}" 
                                           var="sales" 
                                           itemLabel="#{sales.displayIdentifier}" 
                                           itemValue="#{sales}"/>  
                        </h:selectOneMenu>
                        <h:outputLabel value="#{msg['salesAllowances.label.orderNumber']}:" for="orderNumber" styleClass="required"/>
                        <h:inputText id="orderNumber" value="#{applySalesAllowancesController.orderNumber}"/>
                    </h:panelGrid>                    
                    <h:inputHidden binding="#{queryCriteriaController.initSalesHidden}"/>
                    <p:commandButton id="search"
                                     value="#{msg['button.search']}" 
                                     icon="ui-icon-search"
                                     action="#{applySalesAllowancesController.query}" 
                                     update="salesAllowancesVOListScrollBar :messages :growl"/>
                    <p:hotkey bind="return" immediate="false"  action="#{applySalesAllowancesController.query}" update="salesAllowancesVOListScrollBar :messages :growl" />
                </p:fieldset>
                <p:fieldset legend="#{msg['search.result']}:">
                    <p:scrollPanel id="salesAllowancesVOListScrollBar" 
                                   style="width:892px;height:268px;"
                                   styleClass="small">
                        <p:dataTable id="salesAllowancesVOList" 
                                     value="#{applySalesAllowancesController.salesAllowancesVOList}" 
                                     var="row"
                                     style="font-size: 8px;">
                            <p:column>
                                <f:facet name="header">
                                    <p:selectBooleanCheckbox value="#{applySalesAllowancesController.selectAll}">
                                        <p:ajax event="change" 
                                                listener="#{applySalesAllowancesController.selectAllChange}"
                                                update="salesAllowancesVOListScrollBar"/>
                                    </p:selectBooleanCheckbox>
                                </f:facet>
                                <p:selectBooleanCheckbox value="#{row.selected}"/>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.invoiceNumber']}" style="text-align:left; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{row.invoiceNumber}"/>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.orderNumber']}" style="text-align:left; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{row.orderNumber}"/>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.customer']}" style="text-align:left; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{applySalesAllowancesController.getCustomerName(row.customer)}"/>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.item']}" style="text-align:left; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{row.item}"/>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.product']}" style="text-align:left; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{row.product}"/>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.productName']}" style="text-align:left; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{applySalesAllowancesController.getProductName(row.product)}"/>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.amount']}" style="text-align:right; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{row.amount}">
                                    <f:convertNumber pattern="#,###,##0.00"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.premiumDiscount']}" style="white-space: nowrap;font-size:10px;">
                                <h:outputText value="#{row.premiumDiscount}">
                                    <f:convertNumber pattern="#,###,##0.00"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.salesAllowances']}" style="text-align:right; white-space: nowrap;font-size:10px;">
                                <h:outputText value="#{row.salesAllowances}">
                                    <f:convertNumber pattern="#,###,##0.00"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.quantity']}" style="text-align:right; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{row.quantity}">
                                    <f:convertNumber pattern="#,###,##0.00"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.unit']}" style="white-space: nowrap;font-size:10px;">
                                <h:outputText value="#{row.unit}"/>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.price']}" style="text-align:right; white-space:nowrap;font-size:10px;">
                                <h:outputText value="#{row.price}">
                                    <f:convertNumber pattern="#,###,##0.00"/>
                                </h:outputText>
                            </p:column>
                            <p:column headerText="#{msg['salesAllowances.label.averagePrice']}" style="white-space: nowrap;font-size:10px;">
                                <h:outputText value="#{(row.amount-row.premiumDiscount)/row.quantity}"
                                              rendered="#{row.quantity ne 0}">
                                    <f:convertNumber pattern="#,###,##0.00"/>
                                </h:outputText>
                                <h:outputText value="0.00" rendered="#{row.quantity eq 0}"/>
                            </p:column>
                        </p:dataTable>
                    </p:scrollPanel>
                    <h:panelGrid columns="3" width="50%">
                        <h:outputLabel value="#{msg['salesAllowances.label.reason']}:"/>
                        <h:selectOneMenu value="#{applySalesAllowancesController.reason}">
                            <f:selectItems value="#{applySalesAllowancesController.reasonList}"
                                           var="reason"
                                           itemLabel="#{reason.displayName}"
                                           itemValue="#{reason}"/>
                        </h:selectOneMenu>
                        <p:commandButton value="#{msg['salesAllowances.label.addSalesAllowances']}"
                                         icon="ui-icon-plus"
                                         update="salesAllowancesVOListScrollBar salesAllowancesListPanelGroup :messages :growl"
                                         action="#{applySalesAllowancesController.add}"/>
                    </h:panelGrid>
                    <ui:include src="../jsff/salesAllowancesList.xhtml"/>
                </p:fieldset>
                <p />
            </p:panel>    
        </h:form>
        <ui:include src="../jsff/ajaxStatusDlg.xhtml"/>
        <script language="javascript">
        jQuery('#orderNumber').keydown(function(event) {
            if (event.keyCode == 13) {
                jQuery('#search').click();
                return false;
            }
        });
        </script>
    </ui:define>    
</ui:composition>
<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                >
    <h:form id="editAttachmentForm" prependId="false">

        <p:dialog widgetVar="editAttachmentDialogVar"
                  id="editAttachmentDialog"
                  resizable="false"
                  modal="true">
            <f:facet name="header">
                <h:outputText value="#{msg['button.edit']} #{attachmentController.container.displayIdentifier} 的 #{attachmentController.contentRole.displayName}"/>
            </f:facet>
            <h:panelGrid columns="2">
                <h:outputLabel value="#{msg['product']}:"/>
                <h:outputText value="#{attachmentController.container.displayIdentifier}"/>
            </h:panelGrid>
            <h:panelGrid columns="1">
                <p:fileUpload rendered="#{!attachmentController.readonly}"
                              label="#{msg['button.upload']}"
                              auto="true"
                              oncomplete="updateRemoteCommand();"
                              fileUploadListener="#{attachmentController.handleFileUpload}"
                              />
                <p:remoteCommand name="updateRemoteCommand" update="uploadFilesGroup"/>
                <h:panelGroup id="uploadFilesGroup">
                    <p:dataTable value="#{attachmentController.attachmentVOList}"
                                 var="attachmentVO"
                                 rows="10"
                                 paginator="true"
                                 paginatorPosition="bottom"
                                 >
                        <p:column headerText="檔名(點擊下載檔案)">
                            <h:panelGroup style="float: left;">
                                <h:commandLink actionListener="#{attachmentController.downloadAction(attachmentVO)}"
                                               class="uploadFile"
                                               immediate="true"
                                               onclick="monitorDownload();">
                                    <h:graphicImage library="images" name="attach.png" rendered="#{not empty attachmentVO.applicationdata}"/>
                                    <h:graphicImage library="images" name="new.png" rendered="#{empty attachmentVO.applicationdata}"/>
                                    <h:outputText value="#{attachmentVO.fileName}"/>
                                    <p:fileDownload value="#{attachmentController.downloadFile}"/>
                                </h:commandLink>
                            </h:panelGroup>
                        </p:column>
                        <p:column headerText="檔案大小" style="text-align: right;">
                            <h:outputText value="#{attachmentVO.size}">
                                <f:convertNumber pattern="#,###"/>
                            </h:outputText>
                            <h:outputText value=" bytes"/>
                        </p:column>
                        <p:column headerText="#{msg['column.action']}">
                            <p:commandButton actionListener="#{attachmentController.remove(attachmentVO)}"
                                             immediate="true"
                                             update="uploadFilesGroup"
                                             global="false"
                                             icon="ui-icon-trash">
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>
                </h:panelGroup>
            </h:panelGrid>
            <h:panelGrid columns="1" style="width: 100%;text-align: center;">
                <h:panelGroup>
                    <p:commandButton action="#{attachmentController.save}"
                                     update="pictureGroup licenseGroup categoryGroup beLicenseGroup messages growl"
                                     oncomplete="PF('editAttachmentDialogVar').hide();"
                                     value="#{msg['button.save']}"/>
                    <p:commandButton onclick="PF('editAttachmentDialogVar').hide();"
                                     value="#{msg['button.cancel']}"
                                     immediate="true"/>
                </h:panelGroup>
            </h:panelGrid>
        </p:dialog>
    </h:form>
</ui:composition>

<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml"
                >
    <ui:define name="title">
        <h:outputText value="#{msg['func.name.A12']}" />
    </ui:define>
    <ui:define name="head">
        <style type="text/css">
        </style>
        <script type="text/javascript">
            //<![CDATA[
            $(function () {
                // for datatable resize in chrome 
                doResize();
                $(window).resize(function () {
                    doResize();
                });
            });
            
            function afterQuery(){
                doResize();
                scrollY(200);
            }
            
            function confirmDel(){
                // 確定要刪除嗎?
                return confirm("確定要刪除嗎?");
            }
            
            function afterChangeCompany(xhr, status, args){
                if( afterCallBackHandler(xhr, status, args) ){
                    if( args.changeCompany ){
                        if( confirm("確定要變更公司/地區別嗎? 原有設定將全部清除，重新輸入。") ){
                            rcConfirmCompany();
                            return;
                        }
                    }
                }
                rcCancelCompany();
            }
            //]]>
        </script>
    </ui:define>
    <ui:define name="content">
        <!-- 公用訊息區 -->
        <ui:include src="/inc/inc_globalMessage.xhtml"></ui:include>
        
        <h:form id="fmMain" prependId="false" >
            <p:panel header="#{msg['func.name.A12']}" rendered="#{!rfqCreate.functionDenied}" >
                <p:fieldset legend="關聯標案資訊" toggleable="false" >
                    <p:panelGrid columns="4" >
                        <p:outputLabel value="標案編號：" styleClass="fieldname" />
                        <h:panelGroup rendered="#{!empty rfqCreate.tenderVO.id}" >
                            <p:outputLabel value="#{rfqCreate.tenderVO.code}" />
                        </h:panelGroup>
                        <h:panelGroup rendered="#{empty rfqCreate.tenderVO.id}" >
                            <p:inputText value="#{rfqCreate.tenderVO.code}" size="20" 
                                         rendered="#{empty rfqCreate.tenderVO.id}" />

                            <p:commandButton value="查詢" />
                            <i class="fa fa-arrow-circle-down fa-1x"></i>
                            <p:outputLabel value="#{rfqCreate.queryResultMsg}" />
                        </h:panelGroup>
                    </p:panelGrid>
                    <hr/>
                    <p:panelGrid columns="6" >
                        <p:outputLabel value="標案名稱：" styleClass="fieldname" />
                        <p:outputLabel value="#{rfqCreate.tenderVO.title}" />

                        <p:outputLabel value="公司/地區：" styleClass="fieldname" />
                        <h:panelGroup rendered="#{!empty rfqCreate.tenderVO}" >
                            <p:outputLabel value="#{rfqCreate.tenderVO.companyName}" />
                        </h:panelGroup>
                        <!--
                        <h:panelGroup rendered="false" >
                            <p:selectOneMenu id="somCom" value="#{rfqCreate.rfqVO.companyId}" >
                                <f:selectItems value="#{selFactory.companys}" var="row" 
                                               itemLabel="#{row.companyName}" 
                                               itemValue="#{row.id}" />
                                
                                <p:ajax listener="#{rfqCreate.onChangeCompany(false)}" 
                                        oncomplete="afterChangeCompany(xhr, status, args);" 
                                        update=":fmMain" />
                            </p:selectOneMenu>
                            
                            <p:remoteCommand name="rcConfirmCompany" actionListener="#{rfqCreate.onChangeCompany(true)}"
                                             update=":fmMain" oncomplete="afterChangeCompany(xhr, status, args);" /> 
                            <p:remoteCommand name="rcCancelCompany" actionListener="#{rfqCreate.onCancelCompany()}"
                                             update=":fmMain:somCom" oncomplete="afterCallBackHandler(xhr, status, args);" /> 
                        </h:panelGroup>
                        -->
                        
                        <p:outputLabel value="廠別：" styleClass="fieldname" />
                        <h:panelGroup rendered="#{!empty rfqCreate.tenderVO}" >
                            <p:outputLabel value="#{rfqCreate.tenderVO.factoryName}" />
                        </h:panelGroup>
                        <h:panelGroup rendered="false" >
                            <h:panelGroup rendered="#{selFactory.multiFactory}" >
                                <p:commandButton value="挑選"
                                                 actionListener="#{rfqCreate.onOpenSelFactoryDlg()}"
                                                 update=":fmSelectFactory"
                                                 oncomplete="openSelectFactoryDlg(xhr, status, args)" />
                                
                                <p:outputLabel value="#{selFactory.selFactoryDesc}" styleClass="info" />
                            </h:panelGroup>

                            <h:panelGroup rendered="#{!selFactory.multiFactory}" >
                                <p:selectOneMenu value="#{selFactory.factoryId}" >
                                    <f:selectItems value="#{selFactory.factorys}" var="op" 
                                                   itemLabel="#{op.displayLabel}" itemValue="#{op.id}" />
                                </p:selectOneMenu>
                            </h:panelGroup>
                        </h:panelGroup>
                    </p:panelGrid>

                    <p:panelGrid columns="6" >
                        <p:outputLabel value="標案狀態：" styleClass="fieldname" />
                        <p:outputLabel value="#{rfqCreate.tenderVO.statusName}" />
                        
                        <p:outputLabel value="招標/詢價方式：" styleClass="fieldname" />
                        <h:panelGroup >
                            <p:outputLabel value="公開招標" />
                        </h:panelGroup>
                    </p:panelGrid>
                </p:fieldset>
                <!-- BEGIN : 輸入詢價單資訊 : 基本資訊 -->
                <p:fieldset legend="輸入詢價單資訊" toggleable="true" >
                    <p:panelGrid columns="8" >
                        <p:outputLabel value="詢價單日期：" styleClass="fieldname" />
                        <h:panelGroup >
                            <p:calendar />
                        </h:panelGroup>
                        <p:outputLabel value="採購截止日：" styleClass="fieldname" />
                        <h:panelGroup >
                            <p:calendar />
                        </h:panelGroup>
                        <p:outputLabel value="採購組織：" styleClass="fieldname" />
                        <h:panelGroup >
                            <p:selectOneMenu >
                            </p:selectOneMenu>
                        </h:panelGroup>
                        <p:outputLabel value="採購群組：" styleClass="fieldname" />
                        <h:panelGroup >
                            <p:selectOneMenu >
                            </p:selectOneMenu>
                        </h:panelGroup>                        
                    </p:panelGrid>
                </p:fieldset>
                <!-- END : 輸入詢價單資訊 : 基本資訊 -->
                
                <!-- BEGIN : 輸入詢價單資訊 : 選取採購項目 -->
                <p:fieldset legend="選取採購項目" toggleable="true" >
                    <p:panelGrid columns="4" >
                        <p:outputLabel value="輸入請購單號：" />
                        <h:panelGroup >
                            <p:inputText size="12" />
                            <p:spacer width="2" height="2" />
                            <p:commandButton value="查詢" />
                            <p:spacer width="2" height="2" />
                            <p:commandButton value="加入" />
                        </h:panelGroup>
                        
                        <p:outputLabel value="已加入請購單：" />
                        <h:panelGroup >
                            <p:selectOneMenu >
                            </p:selectOneMenu>
                            <p:spacer width="2" height="2" />
                            <p:commandButton value="移除此請購單" />
                        </h:panelGroup>
                    </p:panelGrid>

                    <h:panelGroup id="pgPrItemList" >
                        <h:panelGroup>
                            <i class="fa fa-1x fa-arrow-circle-o-right" style="padding:3px;" ></i>
                            <p:outputLabel value="請購品項，包含 5 項：" />
                            <p:outputLabel value="(勾選加入品項，及輸入指定數量)" />
                        </h:panelGroup>
                        
                        <p:dataTable id="dtPrItemList" var="row" lazy="true" reflow="true"
                                 widgetVar="wvDtPrItemList"
                                 styleClass="ui-datatable-hor-scroll"
                                 scrollable="true" 
                                 paginator="true"
                                 paginatorPosition="bottom"
                                 rows="5"
                                 rowsPerPageTemplate="5,10,20,30,40,50"
                                 >
                            <p:column headerText="勾選">
                            </p:column>
                            <p:column headerText="詢價數量">
                            </p:column>
                            <p:column headerText="刪除指示碼">
                            </p:column>
                            <p:column headerText="項目">
                            </p:column>
                            <p:column headerText="處理狀態">
                            </p:column>
                            <p:column headerText="物料">
                            </p:column>
                            <p:column headerText="短文">
                            </p:column>
                            <p:column headerText="請購數量">
                            </p:column>
                            <p:column headerText="單位">
                            </p:column>
                            <p:column headerText="交貨日期">
                            </p:column>
                            <p:column headerText="物料群組">
                            </p:column>
                            <p:column headerText="工廠">
                            </p:column>
                            <p:column headerText="儲存地點">
                            </p:column>
                            <p:column headerText="申請人">
                            </p:column>
                        </p:dataTable>

                        <h:panelGroup id="pgPrSrvList" rendered="true" >
                            <h:panelGroup>
                                <i class="fa fa-1x fa-arrow-circle-o-right" style="padding:3px;" ></i>
                                <p:outputLabel value="服務品項，包含 4 項：" />
                                <p:outputLabel value="(勾選加入品項，及輸入指定數量)" />
                            </h:panelGroup>
                            
                            <p:dataTable id="dtPrSrvList" var="row" lazy="true" reflow="true"
                                     widgetVar="wvDtPrSrvList" 
                                     styleClass="ui-datatable-hor-scroll"
                                     scrollable="true" 
                                     paginator="true"
                                     paginatorPosition="bottom"
                                     rows="5"
                                     rowsPerPageTemplate="5,10,20,30,40,50"
                                     >
                                <p:column headerText="勾選">
                                </p:column>
                                <p:column headerText="詢價數量">
                                </p:column>
                                <p:column headerText="刪除指示碼">
                                </p:column>
                                <p:column headerText="服務號碼">
                                </p:column>
                                <p:column headerText="短文">
                                </p:column>
                                <p:column headerText="數量">
                                </p:column>
                                <p:column headerText="單位">
                                </p:column>
                                <p:column headerText="總價">
                                </p:column>
                                <p:column headerText="幣別">
                                </p:column>
                            </p:dataTable>
                        </h:panelGroup>
                        
                        <h:panelGroup>
                            <p:commandButton value="確定加入/修改" />
                        </h:panelGroup>
                    </h:panelGroup>
                </p:fieldset>
                <!-- END : 輸入詢價單資訊 : 選取採購項目 -->

                <!-- BEGIN : 詢價單品項列表　-->
                <p:fieldset legend="詢價單品項列表" toggleable="true" >
                    <p:dataTable id="dtRfqItemList" var="row" lazy="true" reflow="true"
                             widgetVar="wvDtRfqItemList" 
                             styleClass="ui-datatable-hor-scroll"
                             scrollable="true" 
                             paginator="true"
                             paginatorPosition="bottom"
                             rows="5"
                             rowsPerPageTemplate="5,10,20,30,40,50"
                             >
                        <p:column headerText="項次">
                        </p:column>
                        <p:column headerText="料號">
                        </p:column>
                        <p:column headerText="品名規格">
                        </p:column>
                        <p:column headerText="數量＊">
                        </p:column>
                        <p:column headerText="單位">
                        </p:column>
                        <p:column headerText="交貨日期＊">
                        </p:column>
                        <p:column headerText="單價">
                        </p:column>
                        <p:column headerText="預估總價">
                        </p:column>
                        <p:column headerText="需求日期">
                        </p:column>
                        <p:column headerText="現有庫存">
                        </p:column>
                        <p:column headerText="待收庫存">
                        </p:column>
                        <p:column headerText="前購單價">
                        </p:column>
                        <p:column headerText="前購日期">
                        </p:column>
                        <p:column headerText="物料群組">
                        </p:column>
                        <p:column headerText="請購部門">
                        </p:column>
                        <p:column headerText="核准編碼">
                        </p:column>
                    </p:dataTable>

                    <!-- 詢價單 服務品項 -->
                    <h:panelGroup id="pgRfqSrvList" rendered="true" >
                        <h:panelGroup>
                            <i class="fa fa-1x fa-arrow-circle-o-right" style="padding:3px;" ></i>
                            <p:outputLabel value="服務品項，包含 4 項：" />
                            <p:outputLabel value="(勾選加入品項，及輸入指定數量)" />
                        </h:panelGroup>

                        <p:dataTable id="dtRfqSrvList" var="row" lazy="true" reflow="true"
                                 widgetVar="wvDtRfqSrvList" 
                                 styleClass="ui-datatable-hor-scroll"
                                 scrollable="true" 
                                 paginator="true"
                                 paginatorPosition="bottom"
                                 rows="5"
                                 rowsPerPageTemplate="5,10,20,30,40,50"
                                 >
                            <p:column headerText="勾選">
                            </p:column>
                            <p:column headerText="詢價數量">
                            </p:column>
                            <p:column headerText="刪除指示碼">
                            </p:column>
                            <p:column headerText="服務號碼">
                            </p:column>
                            <p:column headerText="短文">
                            </p:column>
                            <p:column headerText="數量">
                            </p:column>
                            <p:column headerText="單位">
                            </p:column>
                            <p:column headerText="總價">
                            </p:column>
                            <p:column headerText="幣別">
                            </p:column>
                        </p:dataTable>
                    </h:panelGroup>

                </p:fieldset>
                
                <h:panelGroup styleClass="blockBtnC" >
                    <p:commandButton value="確定儲存" />
                </h:panelGroup>
                <!-- END : 輸入詢價單資訊 : 選取採購項目 -->
            </p:panel>
        </h:form>
        
        <!-- 廠別選取對話框 -->
        <ui:include src="/inc/inc_selectFactorys.xhtml">
            <ui:param name="controller" value="#{rfqCreate}"/>
            <ui:param name="update" value=":fmMain"/>
        </ui:include>
        
        <!-- 功能權限檢查對話框 -->
        <ui:include src="/inc/inc_authorizationDlg.xhtml">
            <ui:param name="controller" value="#{rfqCreate}"/>
        </ui:include>
        
    </ui:define>
</ui:composition>

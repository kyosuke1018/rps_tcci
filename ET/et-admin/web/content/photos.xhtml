<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml"
                >
    <ui:define name="title">
        <h:outputText value="#{photos.funcTitle}" />
    </ui:define>
    <ui:define name="head">
        <style type="text/css">
            .leftCol {
                vertical-align: top;
                text-align: left;
            }
            .mainCol {
                vertical-align: top;
                text-align: left;
                min-width: 450px;
            }
            .vmCol {
                vertical-align: middle;
            }
            .vbCol{
                vertical-align: baseline;
            }
            .ui-tree {
                width: 250px;
            }
        </style>
        <script type="text/javascript">
            //<![CDATA[
            function selectImage(file){ //, elf) {
                //alert(typeof parent.tinymce);
                if (typeof parent.tinymce !== "undefined") {
                    parent.tinymce.activeEditor.windowManager.getParams().oninsert(file);//, elf);
                    parent.tinymce.activeEditor.windowManager.close();
                }
                return false;
            }            
            //]]>
        </script>
    </ui:define>
    <ui:define name="content">
        <!-- 公用訊息區 -->
        <ui:include src="/inc/inc_globalMessage.xhtml"></ui:include>
        
        <h:form id="fmMain" prependId="false" >
            <p:panel header="#{photos.funcTitle}" style="overflow-x: scroll;" rendered="#{!photos.functionDenied}" >
                <p:panelGrid columns="2" columnClasses="leftCol,mainCol" >
                    <!-- 圖庫樹狀圖 -->
                    <ui:include src="/inc/content/inc_photosTree.xhtml"></ui:include>
                    
                    <p:panel id="plRight">
                        <h:panelGroup>
                            <p:outputLabel value="樹狀圖寬度調整：" />
                            <p:commandLink onclick="resizeTree(false)" title="縮小樹狀圖寬度(最小250px)" immediate="true" >
                                <h:graphicImage library="images" name="resultset_previous.png" styleClass="iconsBig" />
                            </p:commandLink>
                            <p:commandLink onclick="resizeTree(true)" title="放大樹狀圖寬度(最大650px)" immediate="true" >
                                <h:graphicImage library="images" name="resultset_next.png" styleClass="iconsBig" />
                            </p:commandLink>
                            
                            <p:outputLabel value="(有資料夾名稱被遮蓋時，放大才會有作用；寬度最小250px，最大650px。)" styleClass="info" />
                            <br/>
                        </h:panelGroup>
                        
                        <!-- BEGIN: C 自訂相簿/圖庫 -->
                        <h:panelGroup id="pgOptions" rendered="#{photos.showCustomAlbum()}" >
                            <!-- 目前選取資料夾 -->
                            <h:panelGroup rendered="#{!empty photos.editVO}" >
                                <p:outputLabel rendered="#{!empty photos.editVO.parentName}" 
                                    value="#{photos.editVO.parentName}／" />
                                <p:outputLabel value="#{photos.editVO.cname}" styleClass="fieldvalue" />
                                <p:spacer width="5" height="10" />
                                <h:graphicImage library="images" name="1rightarrow.png" styleClass="icons" />
                                <p:spacer width="5" height="10" />
                            </h:panelGroup>
                            
                            <h:panelGroup rendered="#{photos.editVO.canEdit and photos.editVO.canAddSub}">
                                <p:selectOneButton value="#{photos.mode}" >
                                    <f:selectItem itemLabel="編輯基本資料" itemValue="#{ui.modifyCode}" />
                                    <f:selectItem rendered="#{photos.editVO.canAddSub}" 
                                        itemLabel="新增子資料夾/相簿" itemValue="#{ui.addSubCode}" />
                                    <f:selectItem itemLabel="新增圖片" itemValue="#{ui.uploadSubCode}" />
                                    <p:ajax event="change" listener="#{photos.changeEditMode()}" update=":fmMain:pgOptions" />
                                </p:selectOneButton>
                            </h:panelGroup>
                            
                            <h:panelGroup rendered="#{photos.editVO.canEdit and !photos.editVO.canAddSub}">
                                <p:selectOneButton value="#{photos.mode}" >
                                    <f:selectItem itemLabel="編輯基本資料" itemValue="#{ui.modifyCode}" />
                                    <f:selectItem itemLabel="新增圖片" itemValue="#{ui.uploadSubCode}" />
                                    <p:ajax event="change" listener="#{photos.changeEditMode()}" update=":fmMain:pgOptions" />
                                </p:selectOneButton>
                            </h:panelGroup>

                            <h:panelGroup rendered="#{!photos.editVO.canEdit}">
                                <p:selectOneButton value="#{photos.mode}" >
                                    <f:selectItem rendered="#{photos.editVO.canAddSub}" 
                                        itemLabel="新增子資料夾/相簿" itemValue="#{ui.addSubCode}" />
                                    <p:ajax event="change" listener="#{photos.changeEditMode()}" update=":fmMain:pgOptions" />
                                </p:selectOneButton>
                            </h:panelGroup>
                            
                            <p:separator />
                            
                            <!-- 編輯基本資料 -->
                            <p:fieldset legend="基本資訊" toggleable="true" rendered="#{photos.showEditNodeBlock()}" >
                                <p:panelGrid columns="2" styleClass="vmCol,vmCol" rendered="#{!photos.editVO.canEdit}" >
                                    <p:outputLabel value="名稱：" styleClass="fieldname required" />
                                    <p:outputLabel value="#{photos.editVO.cname}" 
                                                   rendered="#{!empty photos.editVO.cname}" styleClass="fieldvalue" />
                                    <p:spacer width="5" height="5" />
                                    <p:outputLabel value="#{photos.editVO.ename}" 
                                                   rendered="#{!empty photos.editVO.ename}" styleClass="fieldvalue" />
                                </p:panelGrid>
                                
                                <!-- C 自訂相簿/圖庫 -->
                                <h:panelGroup rendered="#{photos.showCustomAlbum()}" >
                                    <p:panelGrid columns="2" styleClass="vmCol,vmCol" rendered="#{photos.editVO.canEdit}" >
                                        <p:outputLabel value="名稱：" styleClass="fieldname required" />
                                        <h:panelGroup >
                                            <p:outputLabel value="(中)" title="中文名稱" />
                                            <p:inputText size="60" value="#{photos.editVO.cname}"
                                                         disabled="#{!photos.editVO.canEdit}" />
                                            <br/>
                                            <p:outputLabel value="(英)" title="英文名稱" />
                                            <p:inputText size="60" value="#{photos.editVO.ename}"
                                                         disabled="#{!photos.editVO.canEdit}" />
                                            <br/>
                                            <p:outputLabel value="(若要英文網站可顯示相簿英文名稱，請輸入英文名稱欄位。)" styleClass="info" /> 
                                        </h:panelGroup>
                                        
                                        <p:outputLabel value="資料日期：" styleClass="fieldname required" title="會影響前端網頁排序" />
                                        <h:panelGroup>
                                            <p:calendar  showOn="button" size="14" maxlength="10" readonlyInput="false" navigator="true"
                                                         value="#{photos.editVO.dataDate}" 
                                                         converterMessage="日期格式錯誤(yyyy/MM/dd)" 
                                                         pattern="yyyy/MM/dd" />
                                            <p:spacer width="10" height="5" />
                                            <p:outputLabel value="所屬資料夾：" styleClass="fieldname required" />
                                            <p:selectOneMenu value="#{photos.editVO.parentIdStr}" >
                                                <f:selectItems value="#{photos.getCustomParentOptions(photos.editVO.id)}" />
                                            </p:selectOneMenu>
                                            
                                            <p:spacer width="10" height="5" />
                                            <p:outputLabel value="網站語系：" styleClass="fieldname" />
                                            <p:selectOneMenu value="#{photos.editVO.lang}" >
                                                <f:selectItems value="#{ui.langWebSiteOptions}" ></f:selectItems>
                                            </p:selectOneMenu>
                                        </h:panelGroup>
                                        
                                        <p:outputLabel value="簡介：" styleClass="fieldname" />
                                        <h:panelGroup >
                                            <p:inputTextarea style="vertical-align: middle;"
                                                             cols="50" rows="3" value="#{photos.editVO.description}" 
                                                             disabled="#{!photos.editVO.canEdit}" />
                                            
                                            <p:spacer width="5" height="5" />
                                            <p:outputLabel value="狀態：" styleClass="fieldname" />
                                            <p:selectOneMenu value="#{photos.editVO.status}" disabled="#{!photos.editVO.canEdit}" >
                                                <f:selectItems value="#{ui.contentStatusOptions}" ></f:selectItems>
                                            </p:selectOneMenu>
                                            
                                            <p:spacer width="5" height="5" />
                                            <p:commandButton value="儲存" 
                                                             rendered="#{!photos.readOnly and photos.editVO.canEdit}" 
                                                             icon="ui-icon-disk"
                                                             actionListener="#{photos.saveBasic()}"
                                                             oncomplete="afterCallBackHandler(xhr, status, args);"
                                                             update="pgTree pgOptions" ></p:commandButton>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </h:panelGroup>
                                
                            </p:fieldset>
                            
                            <!-- 子資料夾/相簿資訊 -->
                            <p:fieldset legend="子資料夾/相簿資訊" toggleable="true" rendered="#{photos.showAddSubNodeBlock()}" >
                                <!-- C 自訂相簿/圖庫 -->
                                <h:panelGroup rendered="#{photos.showCustomAlbum()}" >
                                    <p:panelGrid columns="2" styleClass="vmCol,vmCol" >
                                        <p:outputLabel value="名稱：" styleClass="fieldname required" />
                                        <h:panelGroup >
                                            <p:outputLabel value="(中)" title="中文名稱" />
                                            <p:inputText size="60" value="#{photos.editSubVO.cname}" />
                                            <br/>
                                            <p:outputLabel value="(英)" title="英文名稱" />
                                            <p:inputText size="60" value="#{photos.editSubVO.ename}" />
                                            <br/>
                                            <p:outputLabel value="(若要英文網站可顯示相簿英文名稱，請輸入英文名稱欄位。)" styleClass="info" /> 
                                        </h:panelGroup>
                                        
                                        <p:outputLabel value="資料日期：" styleClass="fieldname required" title="會影響前端網頁排序" />
                                        <h:panelGroup >
                                            <p:calendar  showOn="button" size="14" maxlength="10" readonlyInput="false" navigator="true"
                                                         value="#{photos.editSubVO.dataDate}" 
                                                         converterMessage="日期格式錯誤(yyyy/MM/dd)" 
                                                         pattern="yyyy/MM/dd" />
                                            <p:spacer width="10" height="5" />
                                            <p:outputLabel value="所屬資料夾：" styleClass="fieldname required" />
                                            <p:outputLabel value="#{photos.editVO.cname}" styleClass="fieldvalue" />
                                            
                                            <p:spacer width="10" height="5" />
                                            <p:outputLabel value="網站語系：" styleClass="fieldname" />
                                            <p:selectOneMenu value="#{photos.editSubVO.lang}" >
                                                <f:selectItems value="#{ui.langWebSiteOptions}" ></f:selectItems>
                                            </p:selectOneMenu>
                                        </h:panelGroup>
                                        
                                        <p:outputLabel value="簡介：" styleClass="fieldname" />
                                        <h:panelGroup>
                                            <p:inputTextarea style="vertical-align: middle;" cols="50" rows="3" 
                                                             value="#{photos.editSubVO.description}" />
                                            
                                            <p:spacer width="5" height="5" />
                                            <p:outputLabel value="狀態：" styleClass="fieldname" />
                                            <p:selectOneMenu value="#{photos.editSubVO.status}" >
                                                <f:selectItems value="#{ui.contentStatusOptions}" ></f:selectItems>
                                            </p:selectOneMenu>
                                            
                                            <p:spacer width="5" height="5" />
                                            <p:commandButton value="儲存" 
                                                             icon="ui-icon-disk"
                                                             rendered="#{!photos.readOnly}" 
                                                             actionListener="#{photos.saveFolder()}" 
                                                             oncomplete="afterCallBackHandler(xhr, status, args);"
                                                             update="pgTree" ></p:commandButton>
                                        </h:panelGroup>
                                    </p:panelGrid>
                                </h:panelGroup>    
                                
                            </p:fieldset>
                            
                            <!-- 圖片資訊 -->
                            <p:fieldset id="fsUploadImage" legend="圖片資訊" toggleable="true" rendered="#{photos.showUploadBlock()}" >
                                <p:panelGrid columns="2" styleClass="vmCol,vmCol" >
                                    <p:outputLabel value="圖片說明：" styleClass="fieldname" />
                                    <p:inputText size="60" value="#{photos.editSubVO.subject}" />
                                    
                                    <p:outputLabel value="上傳圖片：" styleClass="fieldname required" rendered="#{photos.canUploadImage()}" />
                                    <h:panelGroup id="pgUploadImage"  rendered="#{photos.canUploadImage()}" >
                                        <div style="max-height:300px; overflow-y: auto;" >
                                            <p:fileUpload fileUploadListener="#{fileController.handleFileUpload}" 
                                                          update="pgUploadImage pgUploadBtn" 
                                                          multiple="true" fileLimit="20" 
                                                          allowTypes="/(\.|\/)(gif|jpe?g|png)$/" 
                                                          fileLimitMessage="一次最多上傳20個檔案"
                                                          invalidFileMessage="不支援的檔案格式"
                                                          invalidSizeMessage="檔案大小超過限制"
                                                          label="選取圖片" cancelLabel="取消" uploadLabel="上傳圖片" />
                                        </div>
                                        <p:outputLabel rendered="#{!empty fileController.files}" 
                                                       value="已傳 #{fileController.files.size()} 張圖片，請記得維護[狀態]後儲存。" styleClass="info" ></p:outputLabel>
                                        <p:outputLabel rendered="#{empty fileController.files}" styleClass="info" 
                                                       value="(一次最多選取10個檔案，每個檔案不可超過10MB。)" />
                                    </h:panelGroup>
                                    
                                    <p:outputLabel value="所屬資料夾：" styleClass="fieldname required" />
                                    <p:selectOneMenu value="#{photos.editSubVO.parentIdStr}" >
                                        <f:selectItems value="#{photos.getCustomParentOptions(photos.editSubVO.id)}" />
                                    </p:selectOneMenu>
                                    
                                    <p:outputLabel value="狀態：" styleClass="fieldname" />
                                    <h:panelGroup id="pgUploadBtn" >
                                        <p:selectOneMenu value="#{photos.editSubVO.status}" >
                                            <f:selectItems value="#{ui.contentStatusOptions}" ></f:selectItems>
                                        </p:selectOneMenu>
                                        <p:spacer width="5" height="5" />
                                        <p:commandButton value="儲存" 
                                                         rendered="#{!photos.readOnly}" 
                                                         icon="ui-icon-disk"
                                                         process="fsUploadImage" 
                                                         update="pgIncList" 
                                                         oncomplete="afterCallBackHandler(xhr, status, args);"
                                                         disabled="#{!photos.canSaveUpload()}" 
                                                         actionListener="#{photos.saveImages()}" ></p:commandButton>
                                        
                                        <h:panelGroup rendered="#{!empty photos.editSubVO.id}" >
                                            <p:spacer width="10" height="10" />
                                            <p:outputLabel value="#{photos.editSubVO.description}" styleClass="fieldvalue" />
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </p:panelGrid>
                            </p:fieldset>
                            
                        </h:panelGroup>
                        <!-- END: C 自訂相簿/圖庫 || R 蒐藏植物團體照片 -->
                        
                        <!-- I 文章插圖查詢表單 -->
                        <ui:include src="/inc/content/inc_docSimpleCriteriaForm.xhtml">
                            <ui:param name="controller" value="#{photos}"/>
                        </ui:include>
                        
                        <!-- 包含圖片列表 -->
                        <ui:include src="/inc/content/inc_photosList.xhtml"></ui:include>
                    </p:panel>
                </p:panelGrid>
            </p:panel>
        </h:form>
        
        <!-- 檢視圖片對話框 -->
        <ui:include src="/inc/content/inc_imgViewDlg.xhtml"></ui:include>
        
        <!-- 功能權限檢查對話框 -->
        <ui:include src="/inc/inc_authorizationDlg.xhtml">
            <ui:param name="controller" value="#{photos}"/>
        </ui:include>
        
    </ui:define>
</ui:composition>

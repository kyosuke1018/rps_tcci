<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml"
    >
    <ui:define name="title">#{vcFormEdit.funcTitle}</ui:define>
    <ui:define name="content">
        <!-- 公用訊息區 -->
        <ui:include src="/inc/inc_globalMessage.xhtml"></ui:include>
        
        <p:panel header="#{vcFormEdit.funcTitle}">
            <h:form id="editForm" prependId="false">
                <p:panelGrid columns="2" columnClasses="pgCol1,pgCol2" >
                    <p:panelGrid columns="1" >
                        <p:panelGrid columns="3" >
                            <h:outputLabel value="申請人:"/>
                            <h:panelGroup styleClass="applicantInfo">
                                <h:outputText value="#{vcFormEdit.editVO.applicantName}"/>
                                <h:outputText value="(#{vcFormEdit.editVO.applicantAd})"/>
                            </h:panelGroup>
                            <p:spacer width="2" />
                            <h:outputLabel value="廠別:"/>
                            <h:outputText value="#{vcFormEdit.editVO.factoryName}"/>
                            <p:spacer width="2" />
                            <h:outputLabel value="client：" />
                            <h:outputText value="#{vcFormEdit.editVO.mandt}" />
                            <p:spacer width="2" />
                            <h:outputLabel value="供應商代碼：" />
                            <h:outputText value="#{vcFormEdit.editVO.venderCode}" />
                            <p:spacer width="2" />
                            <h:outputLabel value="供應商名稱：" />
                            <h:outputText value="#{vcFormEdit.editVO.cname}" />
                            <p:spacer width="2" />
                            
                            <p:outputLabel value="分類：" />
                            <h:panelGroup >
                                <p:selectCheckboxMenu label="選取分類" id="smmCategorys" value="#{vcFormEdit.selectedCategorys}" 
                                                      filter="true" filterMatchMode="contains" panelStyle="width:480px" scrollHeight="400">
                                    <f:selectItems value="#{vcFormEdit.categoryOptionList}" var="item"   
                                                   itemLabel="#{item.label}" itemValue="#{item.value}" />
                                    <p:ajax event="change" update=":editForm:pgSelectedGroups" />
                                    <p:ajax event="toggleSelect" update=":editForm:pgSelectedGroups" />
                                </p:selectCheckboxMenu>
                            </h:panelGroup>
                            <p:spacer width="2" />
                        </p:panelGrid>
                    </p:panelGrid>
                    
                    <h:panelGroup id="pgSelectedGroups" >
                        <h:outputText value="已選取分類：" /><br/>
                        <p:scrollPanel style="width:350px;height:300px" mode="native" >
                            <ui:repeat value="#{vcFormEdit.selectedCategoryList}" var="item" >
                                <h:graphicImage library="images" name="1rightarrow.png" styleClass="icons" />
                                <h:outputText value="#{item.label}" /><br/>
                            </ui:repeat>
                        </p:scrollPanel>
                    </h:panelGroup>
                </p:panelGrid>
                
                
                <p:tabView activeIndex="#{vcFormEdit.activeIndex}">
                    <p:tab title="附件(#{vcFormEdit.attachmentSize}筆)">
                        <ui:include src="/include/inc_attachment.xhtml">
                            <ui:param name="attachmentBean" value="#{vcFormEdit.attachmentBean}"/>
                            <ui:param name="contentHolder" value="#{vcFormEdit.form}"/>
                        </ui:include>
                    </p:tab>
<!--                    <p:tab title="簽核流程" rendered="#{not empty vcFormSign.activities}">
                        <ui:include src="/inc/inc_workflow.xhtml">
                            <ui:param name="activities" value="#{vcFormSign.activities}"/>
                            <ui:param name="process" value="#{vcFormSign.form.process}"/>
                        </ui:include>
                    </p:tab>-->
                </p:tabView>
                <h:panelGroup rendered="#{vcFormEdit.initSuccess}">
                    <hr/>
                    <p:commandButton value="提交申請"
                                     icon="ui-icon-check"
                                     onstart="return confirm('確認提交申請?');"
                                     oncomplete="handleAfterSave(xhr, status, args);" 
                                     action="#{vcFormEdit.apply}"/>&nbsp;
<!--                    <p:commandButton value="關閉"
                                     icon="ui-icon-circle-close"
                                     action="#{vcFormEdit.actionClose}"/>-->
                </h:panelGroup>
            </h:form>
        </p:panel>
        <script type="text/javascript">
        //<![CDATA[
        function handleAfterSave(xhr, status, args) {
            //function handleAfterSave() {    
            if( handleCallBack(xhr, status, args) ){
//                PF('wvDlgEdit').hide();
            }
        }
        //]]>
    </script>
    </ui:define>
</ui:composition>
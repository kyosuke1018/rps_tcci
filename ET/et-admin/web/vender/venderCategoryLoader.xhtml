<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml"
                >    
    <ui:define name="title">
        <h:outputText value="#{venderCategoryLoadController.funcTitle}"/>
    </ui:define>
    <ui:define name="head">
        <style type="text/css">
            .tcci-tr {
                background-color: #DFEFFC;
                border:1px solid #C5DBEC !important;
            }
            .tcci-td {                    
                border:1px solid #C5DBEC !important;
            }      
            .tcci-td-error {                    
                border:1px solid #C5DBEC !important;
                background-color: cornsilk;
                color: #FF0000;
            }                           
            .col1 {
                text-align: left; 
                max-width: 80px; 
                white-space: nowrap;
            }
            .col2 {
                text-align: left; 
            }
        </style> 
    </ui:define>
    <ui:define name="content">
        <p:panel header="#{venderCategoryLoadController.funcTitle}">
            <p:tabView id="tabView" dynamic="true" style="width:100%" >   
                <!-- 匯入 TAB -->
                <p:tab title="供應商類別載入" id="import">
                    <h:form id="importForm" prependId="false" >  
                        <p:messages id="messages" showDetail="false" autoUpdate="true"/>
                        <!--for call backing bean method-->
                        <p:remoteCommand name="clearMessages" actionListener="#{venderCategoryLoadController.clearMessages}" update="@form">  
                            <f:setPropertyActionListener value="#{true}" target="#{requestScope.shouldRender}" />                                         
                        </p:remoteCommand>         
                        
                        #{venderCategoryLoadController.triggerPostConstruct()}
                        
                        <p:fieldset legend="#{venderCategoryLoadController.funcTitle}">
                            <h:outputLabel value="#{msg['userloader.select.file.description']}:(Excel File: *.xls)"/><br/>
                            
                            <table border="1" style="width: 100%; border-style: solid;" >
                                <tr>
                                    <td style="text-align: left; width: 150px" rowspan="2">
                                        <h:outputLabel  id="lbUploadFile" styleClass="required" value="上傳Excel:"/>
                                    </td>
                                    <td>
                                        <h:panelGroup id="inc_attachment">
                                            <ui:include src="/inc/inc_attachment.xhtml">
                                                <ui:param name="formName" value="tabView:importForm"/>
                                                <ui:param name="fileUploadUpdate" value=":tabView:importForm"/>
                                                <ui:param name="removeUpdate" value=":tabView:importForm:pBtnGroup"/>
                                            </ui:include>
                                        </h:panelGroup> 
                                    </td> 
                                </tr>
                            </table>  
                            
                            <p/>
                            <!--完整匯入-->
                            <h:panelGroup id="pBtnGroup" >
                                <p:commandButton value="#{msg['userloader.full_import']}" icon="ui-icon ui-icon-disk" 
                                                 title="#{msg['userloader.full_import']}" 
                                                 disabled="#{!venderCategoryLoadController.enableFullImport()}"
                                                 action="#{venderCategoryLoadController.doFullImport}" 
                                                 update="@form"                                         
                                                 />	
                                <!--清除-->
                                <p:spacer width="5px"/>
                                <p:commandButton value="#{venderCategoryLoadController.finished?msg['common.button.next']:msg['common.button.clear']}" icon="#{prplanBatchImport.finished?'ui-icon ui-icon-play':'ui-icon ui-icon-cancel'}"  
                                                 title="#{venderCategoryLoadController.finished?msg['common.button.next']:msg['common.button.clear']}"
                                                 action="#{venderCategoryLoadController.reset}" 
                                                 update="@form"
                                                 />
                                <p:spacer width="5px"/>
                            </h:panelGroup>
                        </p:fieldset>
                        
                        <!-- BEGIN: 匯入結果列表 -->
                        <p:fieldset id="uploadResult" legend="匯入結果">
                            <h:panelGroup rendered="#{venderCategoryLoadController.importResultList != null}">
                                <p:dataTable id="tblImport" 
                                             value="#{venderCategoryLoadController.importResultList}" var="row" 
                                             styleClass="ui-datatable-hor-scroll"
                                             paginator="true" rows="10" 
                                             >
                                    <f:facet  name="header">
                                        <h:panelGroup rendered="#{venderCategoryLoadController.importResultList != null}">
                                            (共#{venderCategoryLoadController.importResultList.size()}筆)
                                        </h:panelGroup>                            
                                    </f:facet>
                                    <p:column headerText="Key">
                                        <f:facet name="header">
                                            <h:outputText value="Key" />  
                                        </f:facet>       
                                        <h:outputText value="USER_INFO" />  
                                    </p:column>
                                    <p:column filterBy="#{row.mandt}" filterMatchMode="contains" >
                                        <f:facet name="header">
                                            <h:outputText value="供應商sap client" />  
                                        </f:facet>                                 
                                        <h:outputText value="#{row.mandt}"/>
                                    </p:column>
                                    <p:column filterBy="#{row.venderCode}" filterMatchMode="contains" >
                                        <f:facet name="header">
                                            <h:outputText value="供應商代碼" />  
                                        </f:facet>                                 
                                        <h:outputText value="#{row.venderCode}"/>
                                    </p:column>
                                    <p:column style="white-space: normal; word-break: break-all" width="180px" >
                                        <f:facet name="header">
                                            <h:outputText value="供應商分類" />  
                                        </f:facet> 
                                        <h:outputText value="#{row.cids}"/>
                                    </p:column>
                                </p:dataTable>  
                                <!-- /div -->
                            </h:panelGroup>    
                        </p:fieldset>
                        <!-- BEGIN: 匯入結果列表 -->
                    </h:form><!-- importForm -->
                    <ui:include src="/vender/inc_note.xhtml"/>                        
                </p:tab>
                
                <!-- 匯出 TAB -->
                <p:tab title="供應商類別匯出" id="export">
                    <h:form prependId="false" id="dataExportForm">
                        <p:messages id="messages2"/>
                        
                        <!-- BEGIN: 查詢條件元件區 -->
                        <p:fieldset legend="#{msg['search.critical']}:" toggleable="true" toggleSpeed="500">
                            <p:panelGrid columns="6" >
                                <p:outputLabel value="帳號或姓名關鍵字：" />
                                <p:inputText id="itKeyword" maxlength="30" size="20" value="#{venderCategoryLoadController.criteriaVO.keyword}" />
                                <p:watermark for="itKeyword" value="輸入帳號或姓名關鍵字" />
                                    
<!--                                <p:outputLabel value="：" />
                                <p:inputText id="itKeyword" maxlength="30" size="20" value="#{venderCategoryLoadController.criteriaVO.keyword}" />
                                <p:watermark for="itKeyword" value="輸入帳號或姓名關鍵字" />-->
                            </p:panelGrid>
                            
                            <!--查詢-->
                            <p:commandButton value="查詢"
                                             icon="ui-icon-search"
                                             update="@form"
                                             actionListener="#{venderCategoryLoadController.query()}" 
                                             />
                            <!--清除按鈕-->
                            <p:spacer width="5px"/>
                            <p:commandButton value="#{msg['common.button.clear']}" 
                                             icon="ui-icon ui-icon-cancel"  
                                             title="#{msg['common.button.clear']}"
                                             actionListener="#{venderCategoryLoadController.resetExport()}" 
                                             update="@form"
                                             />
                        </p:fieldset>
                        <!-- END: 查詢條件元件區 -->
                        
                        <p/>
                        <p:fieldset id="searchResult" legend="#{msg['search.result']}:">
                            <!-- 匯出 EXCEL -->
                            <h:commandLink id="clQuerydataExporter" rendered="#{venderCategoryLoadController.loaderVOList != null}">  
                                <h:graphicImage width="32" height="32" alt="#{msg['common.export.excel']}" library="images" name="excel.png" style="vertical-align: bottom; border:0" />
                                <h:outputLabel value="#{msg['common.export.excel']}"/>
                                <p:dataExporter type="xls" target="dtResult" fileName="venderCategoryExprot"/>                                    
                            </h:commandLink>
                            
                            <!-- BEGIN: 查詢結果列表 -->
                            <h:outputText id="otRowCount" value="(共#{venderCategoryLoadController.countAfterFilter}筆)"/>
                            <p:dataTable id="dtResult" 
                                         value="#{venderCategoryLoadController.loaderVOList}" 
                                         var="row" 
                                         paginator="true" rows="10" 
                                         widgetVar="userLoaderWidgetVar"
                                         styleClass="ui-datatable-hor-scroll"
                                         filteredValue="#{venderCategoryLoadController.filterResultList}" >
                                <!-- filter 後變更筆數 -->
                                <p:ajax event="filter" listener="#{venderCategoryLoadController.onFilter}" update=":tabView:dataExportForm:otRowCount" />
                                <p:column headerText="Key" width="100" >
                                    <f:facet name="header">
                                        <h:outputText value="Key" />  
                                    </f:facet>       
                                    <h:outputText value="VENDER_INFO" />  
                                </p:column>
                                <p:column sortBy="#{row.mandt}" width="100"  
                                          filterBy="#{row.mandt}" filterMatchMode="contains" filterStyle="width:60px"
                                          style="text-align: center; min-width:80px;" >
                                    <f:facet name="header">
                                        <h:outputText value="供應商sap client" />  
                                    </f:facet> 
                                    <h:outputText value="#{row.mandt}"/>
                                </p:column>
                                <p:column sortBy="#{row.venderCode}" width="80"
                                          filterBy="#{row.venderCode}" filterMatchMode="contains" filterStyle="width:80px"
                                          style="text-align: center; min-width:80px;" >
                                    <f:facet name="header">
                                        <h:outputText value="供應商代碼" />  
                                    </f:facet>                                 
                                    <h:outputText value="#{row.venderCode}"/>
                                </p:column>
                                <p:column filterBy="#{row.cids}" filterMatchMode="contains" 
                                          style="white-space: normal; word-break: break-all" filterStyle="width:180px" >
                                    <f:facet name="header" >
                                        <h:outputText value="供應商分類" />  
                                    </f:facet> 
                                    <h:outputText value="#{row.cids}" />
                                </p:column>
                                <p:column filterBy="#{row.cnames}" filterMatchMode="contains" 
                                          style="white-space: normal; word-break: break-all" filterStyle="width:180px" >
                                    <f:facet name="header" >
                                        <h:outputText value="供應商分類" />  
                                    </f:facet> 
                                    <h:outputText value="#{row.cnames}" />
                                </p:column>
                            </p:dataTable>
                        </p:fieldset>
                        <!-- END: 查詢結果列表 -->
                    </h:form>
                    
                    <ui:include src="/vender/inc_note.xhtml"/>       
                </p:tab>
            </p:tabView>
        </p:panel>
    </ui:define>
</ui:composition>

<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml">
    <ui:define name="title">案件</ui:define>
    <ui:define name="content">
        <p:panel header="案件">
            <h:form id="form" prependId="false">
                <h:panelGrid columns="2" width="50%" rendered="#{etSessionController.loginMember ne null}">
                    <h:outputLabel value="loginAccount:"/>
                    <h:outputLabel value="#{etSessionController.loginMember.loginAccount}"/>
                    <h:outputLabel value="name:"/>
                    <h:outputLabel value="#{etSessionController.loginMember.name}"/>
                </h:panelGrid>
                
                <h:panelGroup rendered="#{tenderController.memberVO!=null}" >
                    <p:outputLabel value="會員供應商"/>
                    <h:panelGroup id="pgMV" rendered="#{tenderController.memberVO.venderList!=null}" >
                        <p:dataTable var="rowMV"  
                                     value="#{tenderController.memberVO.venderList}"
                                     styleClass="ui-datatable-hor-scroll"
                                     reflow="true"
                                     rowKey="#{rowMV.id}" >
                            <p:column headerText="id">
                                <h:outputText value="#{rowMV.id}"/>
                            </p:column>
                            <p:column headerText="代碼">
                                <h:outputText value="#{rowMV.venderCode}"/>
                            </p:column>
                            <p:column headerText="名稱">
                                <h:outputText value="#{rowMV.cname}"/>
                            </p:column>
                            <p:column headerText="類別">
                                <h:outputText value="#{rowMV.cnames}"/>
                            </p:column>
                        </p:dataTable>
                    </h:panelGroup>
                </h:panelGroup>
                
                <p:dataTable id="dtResult" var="row"  
                                     value="#{tenderController.tenderList}"
                                     widgetVar="wvDTResult"
                                     styleClass="ui-datatable-hor-scroll"
                                     rows="3"
                                     paginator="false" 
                                     rowKey="#{row.id}" 
                                     reflow="true">
                    <p:column headerText="案件編號">
                        <p:commandLink value="#{row.code ne null?row.code:row.id}"  
                                       actionListener="#{tenderController.selectTender(row.id)}" 
                                       update="form" >
                            <h:outputText value="#{row.code ne null?row.code:row.id}"/>
                        </p:commandLink>
                    </p:column>
                    <p:column headerText="標題">
                        <h:outputText value="#{row.title}"/>
                    </p:column>
                    <p:column headerText="地區">
                        <h:outputText value="#{row.areaName}"/>
                    </p:column>
                    <p:column headerText="類別">
                        <h:outputText value="#{row.categoryName}"/>
                    </p:column>
                    <p:column headerText="狀態">
                        <h:outputText value="#{row.status}"/>
                    </p:column>
                </p:dataTable>
                
                <h:panelGroup id="pgDetail" rendered="#{tenderController.tenderVO!=null}" >
                    <h:panelGrid columns="2" width="100%">
                        <h:outputLabel value="案件編號"/>
                        <h:outputLabel value="#{tenderController.tenderVO.code ne null?tenderController.tenderVO.code:row.id}"/>
                        <h:outputLabel value="標題"/>
                        <h:outputLabel value="#{tenderController.tenderVO.title}"/>
                        <h:outputLabel value="投標公告"/>
                        <!--<h:outputLabel value="#{tenderController.tenderVO.contents}" escape="false"/>-->
                        <p:editor id="editor" widgetVar="editorWidget" value="#{tenderController.tenderVO.contents}" width="600" controls=""  />
                    </h:panelGrid>
                    <h:panelGroup rendered="#{tenderController.attachmentList!=null}" >
                        <h:outputLabel value="投標附件"/>
                        <p:dataTable var="rowAt"  
                                     value="#{tenderController.attachmentList}"
                                     styleClass="ui-datatable-hor-scroll"
                                     reflow="true"
                                     rowKey="#{rowAt.index}" >
                            <p:column headerText="id">
<!--                                <h:commandLink title="下載" actionListener="#{tenderController.fetchDocFile(rowAt.appId)}" >
                                    <h:graphicImage library="images" name="attach.png" styleClass="icons" />
                                    <h:outputText value="#{rowAt.appId}"/>
                                    <p:fileDownload value="#{tenderController.downloadFile}" />
                                </h:commandLink>-->
                                <!--<a href="http://192.168.203.51/et-web/services/tender/file/2/492/3">-->
                                <a href="#{rowAt.url}">
                                    <h:graphicImage library="images" name="attach.png" styleClass="icons" />
                                    <h:outputText value="#{rowAt.appId}"/>
                                </a>
                            </p:column>
                            <p:column headerText="fileName">
                                <h:outputText value="#{rowAt.fileName}"/>
                            </p:column>
                            <p:column headerText="contentType">
                                <h:outputText value="#{rowAt.contentType}"/>
                            </p:column>
<!--                            <p:column headerText="url">
                                <h:outputText value="#{rowAt.url}"/>
                            </p:column>-->
                        </p:dataTable>
                    </h:panelGroup>
                    
                    
                    <h:panelGroup rendered="#{tenderController.memberVO!=null}" >
                        <h:panelGroup id="pgConformLog" rendered="#{tenderController.tenderConformVO!=null and tenderController.tenderConformVO.id!=null}" >
                            <h:panelGrid columns="2" width="50%">
                                <p:outputLabel value="投標確認紀錄"/>
                                <h:panelGroup>
                                    <h:outputLabel value="#{tenderController.tenderConformVO.venderCode}#{tenderController.tenderConformVO.venderName}"/><br/>
                                    <h:outputText value="#{tenderController.tenderConformVO.datadate}">
                                        <f:convertDateTime pattern="yyyy/MM/dd HH:mm"/>
                                    </h:outputText>
                                </h:panelGroup>
                            </h:panelGrid>
                        </h:panelGroup>
                        <h:panelGroup id="pgMatchMV" rendered="#{tenderController.venderList!=null}" >
                            <p:outputLabel value="會員 可投標供應商"/>
                            <p:dataTable var="rowMatchMV"  
                                         value="#{tenderController.venderList}"
                                         styleClass="ui-datatable-hor-scroll"
                                         reflow="true"
                                         rowKey="#{rowMatchMV.id}" >
                                <p:column headerText="動作">
                                    <p:commandButton value="投標確認"
                                                     icon="ui-icon-circle-check"
                                                     action="#{tenderController.conform(rowMatchMV.id)}"
                                                     update="pgDetail"
                                                     rendered="#{tenderController.tenderConformVO.id==null}"/>
                                </p:column>
<!--                                <p:column headerText="id">
                                    <h:outputText value="#{rowMatchMV.id}"/>
                                </p:column>-->
                                <p:column headerText="代碼">
                                    <h:outputText value="#{rowMatchMV.venderCode}"/>
                                </p:column>
                                <p:column headerText="名稱">
                                    <h:outputText value="#{rowMatchMV.cname}"/>
                                </p:column>
                                <p:column headerText="類別">
                                    <h:outputText value="#{rowMatchMV.cnames}"/>
                                </p:column>
                            </p:dataTable>
                        </h:panelGroup>
                        
                        <p:outputLabel value="案件附件"/><br/>
                    </h:panelGroup>
                </h:panelGroup>
            </h:form>
            
            <h:panelGroup id="pgButton">
                <p:commandButton value="login"
                                 icon="ui-icon-circle-check"
                                 action="#{memberController.login}"
                                 update="pgButton"
                                 rendered="#{etSessionController.loginMember eq null}"/>
                <p:commandButton value="logoff"
                                 icon="ui-icon-circle-check"
                                 action="#{memberSession.logout()}"
                                 update="pgButton"
                                 rendered="#{etSessionController.loginMember ne null}"/>
            </h:panelGroup>
        </p:panel>
        
        <!--<ui:include src="/tender/detail.xhtml"></ui:include>-->
    </ui:define>
</ui:composition>
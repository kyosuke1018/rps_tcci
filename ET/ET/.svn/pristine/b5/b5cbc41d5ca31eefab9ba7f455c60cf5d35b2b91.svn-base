<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml"
                >
    <ui:define name="title">
        <h:outputText value="#{conformQueryController.funcTitle}" />
    </ui:define>
    <ui:define name="head">
    </ui:define>
    <ui:define name="content">
        <ui:include src="/inc/inc_globalMessage.xhtml"></ui:include>

        <h:form id="fmMain" prependId="false" >
            <p:panel header="#{conformQueryController.funcTitle}" style="overflow-x: scroll;" rendered="#{!conformQueryController.functionDenied}" >
                <h:panelGroup>

                    <p:fieldset legend="#{msg['search.critical']}" toggleable="true" collapsed="false" >
                        <p:outputLabel value="關鍵字：" styleClass="fieldname" />
                        <h:panelGroup id="pgCriteria" >
                            <p:inputText id="itKeyword" size="30" value="#{conformQueryController.criteriaVO.keyword}" />
                            <p:watermark for="itKeyword" value="輸入供應商代碼或廠商稱號" />
                        </h:panelGroup>

                        <!-- 工廠 -->
                        <p:spacer width="10" height="5" />
                        <p:outputLabel value="廠別：" styleClass="fieldname"/>
                        <p:selectOneMenu value="#{conformQueryController.criteriaVO.factoryId}" >
                            <f:selectItem itemLabel="==" noSelectionOption="true" />
                            <f:selectItems value="#{conformQueryController.factoryOptions}" ></f:selectItems>
                        </p:selectOneMenu>

                        <p:separator />
                        <!-- 查詢 -->
                        <p:commandButton icon="ui-icon-search" value="#{msg['button.search']}"
                                         title="#{msg['button.search']}"
                                         actionListener="#{conformQueryController.doQuery()}" 
                                         oncomplete="doResize('dtResult');"
                                         update="fsResult"/>
                        <p:spacer width="5px"/>
                        <!--清除按鈕-->
                        <p:commandButton value="#{msg['common.button.clear']}"
                                         icon="ui-icon ui-icon-cancel"  
                                         title="#{msg['common.button.clear']}"
                                         actionListener="#{conformQueryController.doReset()}"
                                         oncomplete="doResize('dtResult');" 
                                         update="fsResult"/>
                    </p:fieldset>

                    <!-- BEGIN: 查詢結果列表區 -->
                    <p:fieldset id="fsResult" legend="#{msg['search.result']}">
                        <p:commandLink title="匯出EXCEL檔" immediate="true" ajax="false" onclick="setUpBlockUI();" 
                                       rendered="#{conformQueryController.lazyModel!=null}" >
                            <h:graphicImage library="images" name="excel.png" style="border: none; vertical-align: middle; width: 24px; height: 24px" />
                            <p:dataExporter type="xls" target=":fmMain:dtResult" fileName="venderList" />
                        </p:commandLink>
                        <h:outputText id="otRowCount" value="(共#{conformQueryController.lazyModel.rowCount}筆)" rendered="#{conformQueryController.lazyModel!=null}" />
                        <p:remoteCommand name="rcGetRowCountAfterFiltered" update=":fmMain:otRowCount" />
                        移動查詢結果
                        <ui:include src="/inc/inc_moveDatatbale.xhtml"></ui:include>
                        查詢結果
                        <p:dataTable id="dtResult" var="row"  
                                     value="#{conformQueryController.lazyModel}" lazy="true"
                                     widgetVar="wvDTResult"
                                     filteredValue="#{conformQueryController.filterResultList}"
                                     styleClass="ui-datatable-hor-scroll"
                                     rows="10"
                                     paginator="true" 
                                     reflow="true"
                                     rowKey="#{row.id}" >
                            <!--filter 後變更筆數, 使用 Lazy Loading 不可直接 update 會抓到上次筆數，故用 oncomplete--> 
                            <p:ajax event="filter" oncomplete="doResize(); rcGetRowCountAfterFiltered();" /> 調整寬度 for chrome 


                            <p:column sortBy="#{row.name}" headerText="會員" width="180" filterBy="#{row.name}" filterStyle="width:60px">  
                                <h:outputText value=" #{row.name}" />
                            </p:column>        

                            <p:column  headerText="供應商" width="200" >  
                                <h:outputText value="#{row.venderCode}    #{row.venderName}" />
                            </p:column>

                            <p:column  headerText="案件編號" width="70" sortBy="#{(empty row.code)?row.id:row.code}" >
                                <h:outputText value="#{(empty row.code)?row.id:row.code}" />
                            </p:column>

                            <p:column  headerText="標題" width="180"  filterStyle="width:60px">  
                                <h:outputText value="#{row.title} " />
                            </p:column>

                            <p:column headerText="廠別" width="70" sortBy="#{row.factoryName}" filterBy="#{row.factoryName}" filterStyle="width:60px">
                                <h:outputText value="#{row.factoryName}" />
                            </p:column>

                            <p:column headerText="確認時間" width="80" sortBy="#{row.datadate}" >
                                <h:outputText value="#{row.datadate}">
                                    <f:convertDateTime pattern="yyyy/MM/dd HH:mm"/>
                                </h:outputText>
                            </p:column>
                        </p:dataTable>
                    </p:fieldset>
                    <!-- END: 查詢結果列表區 -->
                </h:panelGroup>
            </p:panel>
        </h:form>

        <!-- 編輯對話框 -->
        <ui:include src="/vender/inc_categoryEditDlg.xhtml"></ui:include>

        <!-- 功能權限檢查對話框 -->
        <ui:include src="/inc/inc_authorizationDlg.xhtml">
            <ui:param name="controller" value="#{venderCategoryController}"/>
        </ui:include>

    </ui:define>
</ui:composition>

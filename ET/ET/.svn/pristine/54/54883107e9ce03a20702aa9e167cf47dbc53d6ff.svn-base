<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://java.sun.com/jsp/jstl/core">
    <p:dataTable value="#{activities}"
                 var="row"
                 rowStyleClass="#{(not empty param['workitem']) and (row.workitem.id eq param['workitem']) ? 'ui-state-highlight':''}"
                 paginator="false"
                 tableStyle="table-layout: auto;"
                 reflow="true">
        <p:column headerText="#{msgBpm['label.activityname']}">
            <!--20180327 無人的activity 顯示空行-->
            <h:outputText value="#{row.activity.activityname}" rendered="#{not empty row.owner}"/>
            <h:outputText value="　" rendered="#{empty row.owner}"/>
            <!--<h:outputText value="#{row.activity.activityname}"/>-->
            <p:commandLink action="#{controller.actionChangeApprover(row)}"
                           update=":formChangeApprover"
                           oncomplete="PF('wvChangeApproverDlg').show()"
                           rendered="#{controller.isApproverEditable(row)}">
                <h:graphicImage library="images" name="user_edit.png"/>
            </p:commandLink>
        </p:column>
        <p:column headerText="#{msgBpm['label.approver']}" style="white-space:normal;">
            <ui:repeat value="#{row.owner}" var="user" varStatus="varStatus">
                <h:outputText value="#{user.displayIdentifier}"/>
                <h:outputText value=", " rendered="#{not varStatus.last}"/>
            </ui:repeat>
        </p:column>
        <p:column headerText="#{msgBpm['label.workitemstate']}">
            <h:outputText value="#{bpmViewHelper.i18nState(row.executionstate)}"/>
        </p:column>
        <p:column headerText="#{msgBpm['label.starttimestamp']}">
            <h:outputText value="#{row.starttimestamp}">
                <f:convertDateTime pattern="yyyy/MM/dd HH:mm"/>
            </h:outputText>
        </p:column>
        <p:column headerText="#{msgBpm['label.endtimestamp']}">
            <h:outputText value="#{row.endtimestamp}">
                <f:convertDateTime pattern="yyyy/MM/dd HH:mm"/>
            </h:outputText>
        </p:column>
        <p:column headerText="#{msgBpm['label.comments']}" style="white-space:normal; text-align: left;">
            <ui:repeat value="#{row.workitem.tcSignatureCollection}" var="sign" varStatus="varStatus">
                <h:outputText value="#{sign.createtimestamp}">
                    <f:convertDateTime pattern="MM/dd HH:mm"/>
                </h:outputText> [<h:outputText value="#{bpmViewHelper.i18nBallot(sign.ballot)}" styleClass="ballot"/>]
                <h:outputText value="#{sign.comments}"/>
                <h:panelGroup rendered="#{not varStatus.last}"><br/></h:panelGroup>
            </ui:repeat>
        </p:column>
    </p:dataTable>
    <h:panelGroup rendered="#{process.executionstate eq 'TERMINATED'}">
        <hr/>
        <h:graphicImage library="images" name="stop_sign.png"/>
        <h:outputText value=" 流程停止 by #{process.terminator.displayIdentifier}, "/>
        <h:outputText value="#{process.endtimestamp}">
            <f:convertDateTime pattern="yyyy/MM/dd HH:mm"/>
        </h:outputText>
        <h:outputText value=", #{process.terminateReason}"/>
    </h:panelGroup>
</ui:composition>

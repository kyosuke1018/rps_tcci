<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml"
                >
    <ui:define name="title">
        <h:outputText value="#{msg['func.name.A24']}" />
    </ui:define>
    <ui:define name="head">
        <style type="text/css">
        </style>
        <script type="text/javascript">
            //<![CDATA[
            $(function () {
                // for datatable resize in chrome 
                doResize();
                $(window).resize(function () {
                    doResize();
                });
            });
            
            function confirmDoNext(){
                if( confirm("確定要離開目前標案決標畫面?\n(注意:未儲存的資料將遺失!)") ){
                    window.location.href = "award.xhtml";
                }
                return false;
            }
            
            function confrimSaveAward(){
                return confirm("確定要儲存決標嗎?");
            }
            
            function confrimCancelAward(){
                return confirm("確定要撤銷此決標設定嗎?");
            }
            
            function confrimNotifyAward(){
                return confirm("確定要發送決標通知嗎?");
            }
            
            function confrimCreatePo(){
                return confirm("確定要建立SAP採購單嗎?");
            }
            //]]>
        </script>
    </ui:define>
    <ui:define name="content">
        <!-- 公用訊息區 -->
        <ui:include src="/inc/inc_globalMessage.xhtml"></ui:include>
        
        <h:form id="fmMain" prependId="false" >
            <p:panel header="#{msg['func.name.A24']}" rendered="#{!tenderAward.functionDenied}" >
                <!-- BEGIN : 關聯標案資訊　-->
                <ui:include src="/inc/tender/inc_tenderBasic.xhtml">
                    <ui:param name="controller" value="#{tenderAward}"/>
                </ui:include>
                <!-- END : 關聯標案資訊　-->
                
                <h:panelGroup rendered="#{!empty tenderAward.tenderVO.id}" >
                    <p:spacer width="5" height="5" />
                    <!-- BEGIN : 新增決標設定　-->
                    <p:panel id="plNotAward" header="新增決標設定" toggleable="true" >
                        <!-- 選取決標廠商 -->
                        <h:panelGroup rendered="#{tenderAward.inSelectVender}" >
                            <i class="fa fa-1x fa-arrow-circle-o-right ps" ></i>
                            <p:outputLabel value="選取決標廠商：" />
                            <p:selectBooleanCheckbox value="#{tenderAward.selectAll}" disabled="#{tenderAward.readOnly}" styleClass="ps info" itemLabel="全選/全不選" >
                                <p:ajax event="change" listener="#{tenderAward.onSelAllVender()}" update=":dgVenders" />
                            </p:selectBooleanCheckbox>
                            <br/>
                            <p:dataGrid id="dgVenders" var="vender" 
                                        value="#{tenderAward.venderQuoList}" 
                                        columns="4" layout="grid" >
                                <p:selectBooleanCheckbox itemLabel="#{vender.venderLabel}" value="#{vender.selected}" />
                            </p:dataGrid>
                            <h:panelGroup styleClass="blockBtnC" >
                                <p:commandButton value="確定" 
                                                 update=":plNotAward" 
                                                 process=":plNotAward" 
                                                 actionListener="#{tenderAward.doConfirmVenderSelect()}" />
                            </h:panelGroup>
                        </h:panelGroup>
                        
                        <!-- 決標設定矩陣 -->
                        <h:panelGroup rendered="#{!tenderAward.inSelectVender}" >
                            <h:panelGroup id="pgRfqItemList" >
                                <h:panelGroup id="otRowCount" rendered="#{!empty tenderAward.lazyModel}" >
                                    <i class="fa fa-1x fa-arrow-circle-o-right ps" ></i>
                                    <p:outputLabel value="此處顯示總金額，一律轉換為 [詢價單幣別] 與 [詢價單數量] 計算，方便做價格的比較。" styleClass="info" />
                                    <br/>
                                    <i class="fa fa-1x fa-arrow-circle-o-right ps" ></i>
                                    <p:outputLabel value="詢價單包含品項數：" />
                                    <p:outputLabel value="#{tenderAward.lazyModel.rowCount}" />
                                </h:panelGroup>

                                <p:remoteCommand name="getRowCountAfterFiltered" update=":fmMain:otRowCount" />

                                <p:dataTable id="dtRfqItemList" var="row" lazy="true"
                                             widgetVar="wvDtRfqItemList" 
                                             styleClass="ui-datatable-hor-scroll"
                                             scrollable="true" 
                                             paginator="true"
                                             paginatorPosition="bottom"
                                             value="#{tenderAward.lazyModel}"
                                             filteredValue="#{tenderAward.filterResultList}"
                                             rows="10"
                                             rowIndexVar="r" 
                                             rowsPerPageTemplate="5,10,20,30,40,50"
                                             >
                                    <p:ajax event="filter" oncomplete="getRowCountAfterFiltered();" />
                                    <p:ajax event="page" process="@none" immediate="true" />
                                    <p:ajax event="sort" process="@none" immediate="true" />

                                    <p:column headerText="項次" footerText="項次" width="40" styleClass="tar" >
                                        <h:outputText value="#{row.ebelp}" />

                                        <h:panelGroup rendered="#{row.srvItem}" > 
                                            <p:spacer width="2" height="2" />
                                            <p:commandLink actionListener="#{tenderAward.onViewRfqSrvItems(row)}" 
                                                           rendered="#{row.srvItem}" 
                                                           update=":pgRfqSrvList" 
                                                           process="@this"
                                                           oncomplete="scrollY(800)" 
                                                           title="查看服務類項目明細" 
                                                           ><i class="fa fa-list fa-1x"></i>
                                            </p:commandLink>
                                        </h:panelGroup>
                                    </p:column>
                                    <p:column headerText="詢價項目" footerText="詢價項目" sortBy="#{row.matnrUI}" width="240">
                                        <p:outputLabel value="物料：" /><h:outputText value="#{row.matnrUI}" />
                                        <br/>
                                        <p:outputLabel value="短文：" /><h:outputText value="#{row.txz01}" />
                                        <br/>
                                        <p:outputLabel value="交貨日期：" />
                                        <h:outputText value="#{row.eindt}" >
                                            <f:convertDateTime pattern="#{app.dateFormat}"/>
                                        </h:outputText>
                                        <br/>
                                        <p:outputLabel value="數量：" /><h:outputText value="#{row.menge}" />
                                        <p:spacer width="2" height="2" />
                                        <p:outputLabel value="(未決標數量：" styleClass="alert"/><h:outputText value="#{row.remaining}" styleClass="alert" /><p:outputLabel value=")" styleClass="alert" />
                                        <br/>
                                        <p:outputLabel value="價格單位：" /><h:outputText value="#{row.peinh}" />
                                    </p:column>

                                    <p:columns value="#{tenderAward.selVenderQuoList}" var="col" columnIndexVar="c"
                                               headerText="#{col.venderName}" footerText="#{col.venderName}" >
                                        <f:facet name="header" >
                                            <div style="width:100%; text-align:left;" >
                                                <h:outputText  value="#{col.venderName}" style="font-weight: bold;" />
                                                <br/>
                                                <h:outputText  value="第 #{col.times} 次報價" style="font-weight: bold;" />
                                                <br/>
                                                <h:outputText  value="稅率：#{col.quoteTaxRate}% " style="font-weight: bold;" />
                                                <br/>
                                                <h:outputText  value="未稅總金額： #{col.totalAmtRfqFx}" style="font-weight: bold;" />
                                                <br/>
                                                <h:outputText  value="含稅總金額： #{col.netAmtRfqFx}" style="font-weight: bold;" />
                                            </div>
                                        </f:facet>

                                        <h:panelGroup rendered="#{tenderAward.quoMatrix[r][c].hasQuote}" >
                                            <p:outputLabel value="得標：" />
                                            <p:selectBooleanCheckbox value="#{tenderAward.quoMatrix[r][c].winning}" >
                                                <p:ajax event="change" listener="#{tenderAward.doSetAward(r, c)}" 
                                                        process=":fmMain:dtRfqItemList"
                                                        update=":fmMain:dtRfqItemList" />
                                            </p:selectBooleanCheckbox>
                                            <br/>
                                            <p:outputLabel value="單價：" />
                                            <h:outputText value="#{tenderAward.quoMatrix[r][c].netpr}" >
                                                <f:convertNumber pattern="#,###.###"/>
                                            </h:outputText>
                                            <h:panelGroup rendered="#{tenderAward.quoMatrix[r][c].srvItem}" >
                                                <p:spacer width="2" height="2" />
                                                <p:commandLink actionListener="#{tenderAward.onViewQuoteSrvItems(tenderAward.quoMatrix[r][c])}" 
                                                               update=":pgQuoteSrvList" 
                                                               process="@this"
                                                               oncomplete="scrollY(800)" 
                                                               title="查看服務類項目明細" 
                                                               ><i class="fa fa-list fa-1x"></i>
                                                </p:commandLink>
                                            </h:panelGroup>
                                            <br/>
                                            <p:outputLabel value="提供數量：" />
                                            <h:outputText value="#{tenderAward.quoMatrix[r][c].menge}" >
                                                <f:convertNumber pattern="#,###.###"/>
                                            </h:outputText>
                                            <br/>
                                            <p:outputLabel value="得標數量：" />
                                            <p:inputText id="itWQ" value="#{tenderAward.quoMatrix[r][c].winningQuantity}" size="8" />
                                        </h:panelGroup>

                                        <h:panelGroup rendered="#{!tenderAward.quoMatrix[r][c].hasQuote}" >
                                            <p:outputLabel value="無報價" />
                                        </h:panelGroup>
                                    </p:columns>
                                </p:dataTable>
                            </h:panelGroup>

                            <!-- RFQ 服務類明細 -->
                            <div id="divTopPgRfqSrvList" ></div>
                            <h:panelGroup id="pgRfqSrvList">
                                <h:panelGroup rendered="#{!empty tenderAward.rfqPmList}">
                                    <h:outputText value="#{tenderAward.queryRfqPmMsg}" class="fieldvalue" />
                                    <p:spacer width="3" height="20" />
                                    <i class="fa fa-1x fa-arrow-circle-o-right ps" ></i>
                                    <p:outputLabel value="包含品項數：" />
                                    <p:outputLabel value="#{tenderAward.rfqPmList.size()}" />
                                    <p:spacer width="3" height="20" />
                                    <p:commandButton value="關閉明細" 
                                                     styleClass="ms" 
                                                     actionListener="#{tenderAward.onCloseRfqPm()}"
                                                     process="@this" 
                                                     update=":pgRfqSrvList" />
                                </h:panelGroup>

                                <p:dataTable id="dtRfqSrvList" var="srv" lazy="true" reflow="true" 
                                             rendered="#{!empty tenderAward.rfqPmList}"
                                             widgetVar="wvDtRfqSrvList" 
                                             styleClass="ui-datatable-hor-scroll"
                                             scrollable="true" 
                                             paginator="true"
                                             paginatorPosition="bottom"
                                             value="#{tenderAward.rfqPmList}" 
                                             rows="5"
                                             rowsPerPageTemplate="5,10,20,30,40,50"
                                             >
                                    <p:column headerText="服務號碼" width="80">
                                        <h:outputText value="#{srv.extrow}" />
                                    </p:column>
                                    <p:column headerText="短文">
                                        <h:outputText value="#{srv.ktext1}" />
                                    </p:column>
                                    <p:column headerText="數量" styleClass="tar" width="80">
                                        <h:outputText value="#{srv.menge}" />
                                    </p:column>
                                    <p:column headerText="單位" width="80">
                                        <h:outputText value="#{srv.meins}" />
                                    </p:column>
                                    <p:column headerText="單價" styleClass="tac" width="80">
                                        <h:outputText value="#{srv.tbtwr}" />
                                    </p:column>
                                    <p:column headerText="總價" styleClass="tar" width="80">
                                        <h:outputText value="#{srv.netwr}" />
                                    </p:column>
                                    <p:column headerText="幣別" width="80">
                                        <h:outputText value="#{srv.waers}" />
                                    </p:column>
                                </p:dataTable>
                            </h:panelGroup>

                            <!-- Quote 服務類明細 -->
                            <div id="divTopPgQuoteSrvList" ></div>
                            <h:panelGroup id="pgQuoteSrvList">
                                <h:panelGroup rendered="#{!empty tenderAward.quotePmList}">
                                    <h:outputText value="#{tenderAward.queryQuotePmMsg}" class="fieldvalue" />
                                    <p:spacer width="3" height="20" />
                                    <i class="fa fa-1x fa-arrow-circle-o-right ps" ></i>
                                    <p:outputLabel value="包含品項數：" />
                                    <p:outputLabel value="#{tenderAward.quotePmList.size()}" />
                                    <p:spacer width="3" height="20" />
                                    <p:commandButton value="關閉明細" 
                                                     styleClass="ms" 
                                                     actionListener="#{tenderAward.onCloseQuotePm()}"
                                                     process="@this" 
                                                     update=":pgQuoteSrvList" />
                                </h:panelGroup>

                                <p:dataTable id="dtQuoteSrvList" var="srv" lazy="true" reflow="true" 
                                             rendered="#{!empty tenderAward.quotePmList}"
                                             widgetVar="wvDtQuoteSrvList" 
                                             styleClass="ui-datatable-hor-scroll"
                                             scrollable="true" 
                                             paginator="true"
                                             paginatorPosition="bottom"
                                             value="#{tenderAward.quotePmList}" 
                                             rows="5"
                                             rowsPerPageTemplate="5,10,20,30,40,50"
                                             >
                                    <p:column headerText="服務號碼" width="80">
                                        <h:outputText value="#{srv.extrow}" />
                                    </p:column>
                                    <p:column headerText="短文">
                                        <h:outputText value="#{srv.ktext1}" />
                                    </p:column>
                                    <p:column headerText="數量" styleClass="tar" width="80">
                                        <h:outputText value="#{srv.menge}" />
                                    </p:column>
                                    <p:column headerText="單位" width="80">
                                        <h:outputText value="#{srv.meins}" />
                                    </p:column>
                                    <p:column headerText="單價" styleClass="tar" width="100" >
                                        <h:outputText value="#{srv.tbtwr}" />
                                    </p:column>
                                    <p:column headerText="總價" styleClass="tar" width="100" >
                                        <h:outputText value="#{srv.netwr}" />
                                    </p:column>
                                    <p:column headerText="單價(預算)" styleClass="tar" width="100" >
                                        <h:outputText value="#{srv.rfqTbtwr}" />
                                    </p:column>
                                    <p:column headerText="總價(預算)" styleClass="tar" width="100" >
                                        <h:outputText value="#{srv.rfqNetwr}" />
                                    </p:column>
                                    <p:column headerText="幣別(預算)" styleClass="tac" width="80">
                                        <h:outputText value="#{srv.waers}" />
                                    </p:column>
                                </p:dataTable>
                            </h:panelGroup>

                            <!-- END : 新增決標設定　-->
                            <h:panelGroup styleClass="blockBtnC" >
                                <p:commandButton value="確定新增決標設定"
                                                 actionListener="#{tenderAward.onSaveAward()}"
                                                 update=":fmMain"
                                                 onstart="return confrimSaveAward()"  
                                                 oncomplete="afterCallBackHandler(xhr, status, args);" />
                                <p:spacer width="5" height="5" />
                                <p:commandButton value="關閉" actionListener="#{tenderAward.doCloseAward()}"
                                                 process="@this" 
                                                 update=":plNotAward" />
                            </h:panelGroup>
                        </h:panelGroup>
                    </p:panel>
                    
                    <p:spacer width="5" height="5" />
                    <!-- BEGIN : 已決標項目　-->
                    <p:panel id="plAward" header="已決標項目" toggleable="true" rendered="#{!empty tenderAward.awardTimeList}" >
                        <p:panelGrid columns="4" >
                            <p:outputLabel value="決標時間：" styleClass="fieldname" />
                            <p:selectOneMenu value="#{tenderAward.awardCode}" >
                                <f:selectItem noSelectionOption="true" />
                                <f:selectItems value="#{tenderAward.awardTimeList}" var="opT" 
                                               itemValue="#{opT.code}" itemLabel="#{opT.timeLabel}" />
                                
                                <p:ajax listener="#{tenderAward.onChangeAwardTime()}"
                                        event="change" update=":plAward" 
                                        process=":plAward" rendered=":plAward"
                                        oncomplete="scrollY(1200)" />
                            </p:selectOneMenu>
                            
                            <p:outputLabel value="得標廠商：" styleClass="fieldname" />
                            <p:selectOneMenu value="#{tenderAward.venderId}" >
                                <f:selectItem noSelectionOption="true" />
                                <f:selectItems value="#{tenderAward.awardVenderList}" var="opV" 
                                               itemValue="#{opV.id}" itemLabel="#{opV.venderLabel}" />
                               
                                <p:ajax listener="#{tenderAward.onChangeAwardVender()}"
                                        event="change" update=":plAward" 
                                        process=":plAward" rendered=":plAward"
                                        oncomplete="scrollY(1200)" />
                            </p:selectOneMenu>
                        </p:panelGrid>
                        
                        <h:panelGroup rendered="#{tenderAward.showAwardItems()}" >
                            <hr />
                            <p:commandButton value="上傳/檢視附件"
                                             actionListener="#{tenderAward.onUploadFiles()}"
                                             process="@this"
                                             update=":plAward"
                                             oncomplete="afterCallBackHandler(xhr, status, args);" />
                            <p:spacer width="5" height="5" />
                            <p:commandButton value="撤銷決標"
                                             actionListener="#{tenderAward.onCancelAward()}"
                                             process="@this"
                                             update=":plAward"
                                             oncomplete="afterCallBackHandler(xhr, status, args);" />
                            <p:spacer width="5" height="5" />
                            <p:commandButton value="通知廠商"
                                             actionListener="#{tenderAward.onNotifyAward()}"
                                             process="@this"
                                             update=":plAward"
                                             onstart="return confrimNotifyAward()"  
                                             oncomplete="afterCallBackHandler(xhr, status, args);" />                    
                            <p:spacer width="5" height="5" />
                            <p:commandButton value="建立採購單"
                                             actionListener="#{tenderAward.onCreatePo()}"
                                             process="@this"
                                             update=":plAward"
                                             onstart="return confrimCreatePo()"  
                                             oncomplete="afterCallBackHandler(xhr, status, args);" />
                            <p:spacer width="5" height="5" />
                            <p:commandButton value="關閉" 
                                             disabled="#{empty tenderAward.otherInfo}" 
                                             actionListener="#{tenderAward.onCancelOtherInfo()}" 
                                             update=":plAward" />
                        </h:panelGroup>
                        
                        <!-- 得標單補充資訊 -->
                        <h:panelGroup id="pgAwardOtherInfo" rendered="#{!empty tenderAward.otherInfo}" >
                            <hr/>
                            <p:panelGrid columns="3" rendered="#{tenderAward.otherInfo eq 'U'}">
                                <p:outputLabel value="上傳附件：" styleClass="fieldname"></p:outputLabel>
                                <h:panelGroup id="pgFile" >
                                    <div style="max-height:300px; max-width: 600px; overflow-y: auto;" >
                                        <p:fileUpload fileUploadListener="#{fileController.handleFileUpload}" 
                                                      rendered="#{!tenderAward.awardVO.readonly}" 
                                                      update=":pgAwardOtherInfo" 
                                                      multiple="true" fileLimit="10" 
                                                      allowTypes="/(\.|\/)(pdf|doc|docx|ppt|pptx|xls|xlsx)$/"
                                                      fileLimitMessage="一次最多上傳10個檔案"
                                                      invalidFileMessage="不支援的檔案格式"
                                                      invalidSizeMessage="檔案大小超過限制"
                                                      sizeLimit="10485760"
                                                      label="選取檔案" cancelLabel="取消" uploadLabel="上傳檔案" />
                                    </div>
                                    <p:outputLabel rendered="#{!empty fileController.files}"
                                               value="已上傳#{fileController.files.size()}個檔案，請記得確認[儲存]。" styleClass="info" />
                                </h:panelGroup>
                                
                                <p:commandButton value="確定儲存" 
                                                 disabled="#{empty fileController.files}" 
                                                 actionListener="#{tenderAward.onSaveAttachments()}"
                                                 process=":pgAwardOtherInfo"
                                                 update=":pgAwardOtherInfo" 
                                                 />
                            </p:panelGrid>
                            
                            <h:panelGroup id="pgExistedFiles" >
                                <p:panelGrid columns="2" rendered="#{!empty tenderAward.awardVO.docs}" >
                                    <p:outputLabel value="已儲存檔案：" styleClass="fieldname" />
                                    <h:panelGroup id="pgUploadFiles" >
                                        <ui:repeat var="doc" value="#{tenderAward.awardVO.docs}" varStatus="status">
                                            <p:outputLabel value="#{doc.fileName}" />
                                            <h:commandLink title="下載" actionListener="#{fileController.fetchDocFile(doc)}" >
                                                <h:graphicImage library="images" name="download.png" styleClass="icons" />
                                                <p:fileDownload value="#{fileController.downloadFile}" />
                                            </h:commandLink>
                                            <p:spacer width="2" height="5"/>
                                            <p:commandLink title="刪除" 
                                                           actionListener="#{tenderAward.deleteFile(doc)}"
                                                           update=":fmMain:pgExistedFiles"
                                                           onclick="if( !confirm('您確定要刪除嗎?') ){ return false; }" 
                                                           oncomplete="afterCallBackHandler(xhr, status, args);"
                                                           rendered="#{(!tenderAward.readOnly) and (!empty doc.applicationdata)}" >
                                                <h:graphicImage library="images" name="delete.png" styleClass="icons" />
                                            </p:commandLink>
                                            <p:spacer width="10" height="5"/>
                                        </ui:repeat>
                                    </h:panelGroup>
                                </p:panelGrid>
                            </h:panelGroup>
                            
                            <!-- 撤銷決標 -->
                            <p:panelGrid columns="4" rendered="#{tenderAward.otherInfo eq 'C'}" >
                                <p:outputLabel value="撤銷原因說明：" />
                                <p:inputTextarea cols="50" rows="3" styleClass="vam" value="#{tenderAward.awardVO.memo}"  />
                                <p:commandButton value="確定送出" 
                                                 actionListener="#{tenderAward.doCancelAward()}" 
                                                 onstart="return confrimCancelAward()"  
                                                 update=":fmMain" />
                                <p:commandButton value="取消" actionListener="#{tenderAward.onCancelOtherInfo()}" update=":plAward" />
                            </p:panelGrid>
                            <!-- SAP PO -->
                            <p:panelGrid columns="2" rendered="#{tenderAward.otherInfo eq 'S'}" >
                                <p:outputLabel value="SAP 採購單補充資訊：" />
                                <p:panelGrid columns="6" >
                                </p:panelGrid>
                            </p:panelGrid>
                        </h:panelGroup>
                        
                        <!-- 得標單明細 -->
                        <h:panelGroup rendered="#{tenderAward.showAwardItems()}">
                            <hr />
                            <h:panelGroup id="otRowCountAward" >
                                <i class="fa fa-1x fa-arrow-circle-o-right ps" ></i>
                                <p:outputLabel value="得標單包含品項數：" />
                                <p:outputLabel value="#{tenderAward.lazyModelAward.rowCount}" />
                            </h:panelGroup>
                            
                            <p:remoteCommand name="getRowCountAwardAfterFiltered" update=":fmMain:otRowCountAward" />
                            
                            <p:dataTable id="dtAwardItemList" var="row" lazy="true" reflow="true"
                                         widgetVar="wvDtAwardItemList" 
                                         styleClass="ui-datatable-hor-scroll"
                                         scrollable="true" 
                                         paginator="true"
                                         paginatorPosition="bottom"
                                         value="#{tenderAward.lazyModelAward}"
                                         filteredValue="#{tenderAward.filterResultListAward}"
                                         rows="10"
                                         rowsPerPageTemplate="5,10,20,30,40,50"
                                         >
                                <p:ajax event="filter" oncomplete="getRowCountAwardAfterFiltered();" />
                                <p:ajax event="page" process="@none" immediate="true" />
                                <p:ajax event="sort" process="@none" immediate="true" />
                                
                                <p:column headerText="詢價項次" sortBy="#{row.ebelp}" width="50" styleClass="tar">
                                    <h:outputText value="#{row.ebelp}" />
                                    
                                    <h:panelGroup rendered="#{row.srvItem}" > 
                                        <p:spacer width="2" height="2" />
                                        <p:commandLink actionListener="#{tenderAward.onViewAwardSrvItems(row)}" 
                                                       rendered="#{row.srvItem}" 
                                                       update=":pgAwardSrvList" 
                                                       process="@this"
                                                       oncomplete="scrollY(1500)" 
                                                       title="查看服務類項目明細" 
                                                       ><i class="fa fa-list fa-1x"></i>
                                        </p:commandLink>
                                    </h:panelGroup>
                                </p:column>
                                <p:column headerText="物料" sortBy="#{row.matnrUI}">
                                    <h:outputText value="#{row.matnrUI}" />
                                </p:column>
                                <p:column headerText="短文" sortBy="#{row.txz01}">
                                    <h:outputText value="#{row.txz01}" />
                                </p:column>
                                <p:column headerText="數量" styleClass="tar">
                                    <h:outputText value="#{row.menge}" />
                                </p:column>
                                <p:column headerText="單位" width="50">
                                    <h:outputText value="#{row.meins}" />
                                </p:column>
                                <p:column headerText="計價數量" styleClass="tar">
                                    <h:outputText value="#{row.peinh}" />
                                </p:column>
                                <p:column headerText="報價幣別" sortBy="#{row.curQuo}" styleClass="tar">
                                    <h:outputText value="#{row.curQuo}" />
                                </p:column>
                                <p:column headerText="單價" styleClass="tar">
                                    <h:outputText value="#{row.peinh}" />
                                </p:column>
                                <p:column headerText="得標數量" styleClass="tar">
                                    <h:outputText value="#{row.winningQuantity}" />
                                </p:column>
                                <p:column headerText="總價" styleClass="tar">
                                    <h:outputText value="#{row.brtwr}" />
                                </p:column>
                                <p:column headerText="交貨日期" width="90">
                                    <h:outputText value="#{row.eindt}" >
                                        <f:convertDateTime pattern="#{app.dateFormat}"/>
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="工廠" sortBy="#{row.werks}" >
                                    <h:outputText value="#{row.werks}" />
                                </p:column>
                                <p:column headerText="請購單號" sortBy="#{row.banfn}" >
                                    <h:outputText value="#{row.banfn}" />
                                </p:column>
                                <p:column headerText="請購項次" sortBy="#{row.bnfpo}" >
                                    <h:outputText value="#{row.bnfpo}" />
                                </p:column>
                            </p:dataTable>
                        </h:panelGroup>
                        
                        <!-- AWARD 服務類明細 -->
                        <div id="divTopPgAwardSrvList" ></div>
                        <h:panelGroup id="pgAwardSrvList" rendered="#{tenderAward.showAwardItems()}" >
                            <h:panelGroup rendered="#{!empty tenderAward.awardPmList}">
                                <h:outputText value="#{tenderAward.queryAwardPmMsg}" class="fieldvalue" />
                                <p:spacer width="3" height="20" />
                                <i class="fa fa-1x fa-arrow-circle-o-right ps" ></i>
                                <p:outputLabel value="包含品項數：" />
                                <p:outputLabel value="#{tenderAward.awardPmList.size()}" />
                                <p:spacer width="3" height="20" />
                                <p:commandButton value="關閉明細" 
                                                 styleClass="ms" 
                                                 actionListener="#{tenderAward.onCloseAwardPm()}"
                                                 process="@this" 
                                                 update=":pgAwardSrvList" />
                            </h:panelGroup>

                            <p:dataTable id="dtAwardSrvList" var="srv" lazy="true" reflow="true" 
                                         rendered="#{!empty tenderAward.awardPmList}"
                                         widgetVar="wvDtAwardSrvList" 
                                         styleClass="ui-datatable-hor-scroll"
                                         scrollable="true" 
                                         paginator="true"
                                         paginatorPosition="bottom"
                                         value="#{tenderAward.awardPmList}" 
                                         rows="5"
                                         rowsPerPageTemplate="5,10,20,30,40,50"
                                         >
                                <p:column headerText="服務號碼" width="80">
                                    <h:outputText value="#{srv.extrow}" />
                                </p:column>
                                <p:column headerText="短文">
                                    <h:outputText value="#{srv.ktext1}" />
                                </p:column>
                                <p:column headerText="數量" styleClass="tar" width="80">
                                    <h:outputText value="#{srv.menge}" />
                                </p:column>
                                <p:column headerText="單位" width="80">
                                    <h:outputText value="#{srv.meins}" />
                                </p:column>
                                <p:column headerText="單價(預算)" styleClass="tac" width="80">
                                    <h:outputText value="#{srv.rfqTbtwr}" />
                                </p:column>
                                <p:column headerText="總價(預算)" styleClass="tar" width="80">
                                    <h:outputText value="#{srv.rfqNetwr}" />
                                </p:column>
                                <p:column headerText="單價(報價)" styleClass="tac" width="80" >
                                    <h:outputText value="#{srv.tbtwr}" />
                                </p:column>
                                <p:column headerText="總價(報價)" styleClass="tar" width="80" >
                                    <h:outputText value="#{srv.netwr}" />
                                </p:column>
                                <p:column headerText="幣別" width="80">
                                    <h:outputText value="#{srv.waers}" />
                                </p:column>
                            </p:dataTable>
                        </h:panelGroup>
                        
                    </p:panel>
                    <!-- BEGIN : 已決標項目　-->
                    
                </h:panelGroup>
            </p:panel>
        </h:form>
        
        <!-- 功能權限檢查對話框 -->
        <ui:include src="/inc/inc_authorizationDlg.xhtml">
            <ui:param name="controller" value="#{tenderAward}"/>
        </ui:include>
        
    </ui:define>
</ui:composition>

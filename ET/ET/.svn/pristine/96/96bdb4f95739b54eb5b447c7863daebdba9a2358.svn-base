<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                >
    <h:panelGroup rendered="#{!photos.showTree}" >
        <div style="width:16px" >
            <p:outputLabel value="樹狀圖已隱藏 ，要開啟請按顯示樹狀圖按鈕 。" styleClass="info" />
        </div>
    </h:panelGroup>
    <h:panelGroup id="pgTree" rendered="#{photos.showTree}" >
        <p:panel header="圖庫樹狀圖" styleClass="plTree" >
            <!-- 圖庫樹狀圖 -->
            <p:tree value="#{photos.root}" 
                    style="min-height:400px; width:max-content;" 
                    var="folder" 
                    selectionMode="single" 
                    selection="#{photos.selectedNode}">
                <p:ajax event="select" listener="#{photos.onNodeSelect}" 
                        onstart="enableAjaxBlockUI(false);" oncomplete="enableAjaxBlockUI(true);" 
                        update=":fmMain:plRight" />
                <p:ajax event="expand" listener="#{photos.onNodeExpand}" />
                <p:ajax event="collapse" listener="#{photos.onNodeCollapse}" />
                    
                <p:treeNode type="#{ui.customImgCode}" expandedIcon="ui-icon-folder-open" 
                            collapsedIcon="ui-icon-folder-collapsed" ><!-- 自訂相簿/圖庫 -->
                    <h:outputText value="#{folder.cname}"
                                  title="#{folder.cname}(#{folder.id})"
                                  style="#{(!empty folder.code)?'color:red;':''}" />
                    <p:commandLink title="刪除"  
                                   rendered="#{photos.canDeleteFolder(folder)}"
                                   actionListener="#{photos.deleteFolder(folder)}"
                                   oncomplete="afterCallBackHandler(xhr, status, args);"
                                   update=":fmMain:pgTree"
                                   onclick="if( !confirm('您確定要刪除嗎?') ){ return false; }" 
                                   >
                        <h:graphicImage library="images" name="delete.png" styleClass="icons" />
                    </p:commandLink>
                    
                </p:treeNode>
                
                <p:treeNode type="#{ui.docImgCode}" icon="ui-icon-document"><!-- 文章插圖 -->
                    <h:outputText value="#{folder.cname}" title="#{folder.cname}"/>
                    <h:graphicImage rendered="#{empty folder.parent}"
                                    title="此部分圖片，為[B1.文章管理]中[自訂網頁]類型文章，直接上傳的插圖。" 
                                    library="images" name="info.png" styleClass="icons" style="cursor: help;" />
                </p:treeNode>
            </p:tree>
        </p:panel>
    </h:panelGroup>
</ui:composition>
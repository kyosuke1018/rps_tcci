<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                template="/templates/generalPageTemplate.xhtml"
                >    
    <ui:define name="title">
        <h:outputText value="#{memberLoadController.funcTitle}"/>
    </ui:define>
    <ui:define name="head">
        <style type="text/css">
            .tcci-tr {
                background-color: #DFEFFC;
                border:1px solid #C5DBEC !important;
            }
            .tcci-td {                    
                border:1px solid #C5DBEC !important;
            }      
            .tcci-td-error {                    
                border:1px solid #C5DBEC !important;
                background-color: cornsilk;
                color: #FF0000;
            }                           
            .col1 {
                text-align: left; 
                max-width: 80px; 
                white-space: nowrap;
            }
            .col2 {
                text-align: left; 
            }
        </style> 
    </ui:define>
    <ui:define name="content">
        <p:panel header="#{memberLoadController.funcTitle}">
            <p:tabView id="tabView" dynamic="true" style="width:100%" >   
                <!-- 匯入 TAB -->
                <p:tab title="#{msg['userloader.loader.title']}" id="import">
                    <h:form id="importForm" prependId="false" >  
                        <p:messages id="messages" showDetail="false" autoUpdate="true"/>
                        <!--for call backing bean method-->
                        <p:remoteCommand name="clearMessages" actionListener="#{memberLoadController.clearMessages}" update="@form">  
                            <f:setPropertyActionListener value="#{true}" target="#{requestScope.shouldRender}" />                                         
                        </p:remoteCommand>         
                        
                        #{memberLoadController.triggerPostConstruct()}
                        
                        <p:fieldset legend="#{memberLoadController.funcTitle}">
                            <h:outputLabel value="#{msg['userloader.select.file.description']}:(Excel File: *.xls)"/><br/>
                            
                            <table border="1" style="width: 100%; border-style: solid;" >
                                <tr>
                                    <td style="text-align: left; width: 150px" rowspan="2">
                                        <h:outputLabel  id="lbUploadFile" styleClass="required" value="上傳Excel:"/>
                                    </td>
                                    <td>
                                        <h:panelGroup id="inc_attachment">
                                            <ui:include src="/inc/inc_attachment.xhtml">
                                                <ui:param name="formName" value="tabView:importForm"/>
                                                <ui:param name="fileUploadUpdate" value=":tabView:importForm"/>
                                                <ui:param name="removeUpdate" value=":tabView:importForm:pBtnGroup"/>
                                            </ui:include>
                                        </h:panelGroup> 
                                    </td> 
                                </tr>
                            </table>  
                            
                            <p/>
                            <!--完整匯入-->
                            <h:panelGroup id="pBtnGroup" >
                                <p:outputLabel value="供應商sap client：" />
                                <p:inputText id="itMandt" maxlength="3" size="3" value="#{memberLoadController.criteriaVO.type}" />
                                <p:watermark for="itMandt" value="輸入供應商sap client" />
                                    
                                <p:commandButton value="#{msg['userloader.full_import']}" icon="ui-icon ui-icon-disk" 
                                                 title="#{msg['userloader.full_import']}" 
                                                 disabled="#{!memberLoadController.enableFullImport()}"
                                                 action="#{memberLoadController.doFullImport}" 
                                                 update="@form"                                         
                                                 />	
                                <!--清除-->
                                <p:spacer width="5px"/>
                                <p:commandButton value="#{memberLoadController.finished?msg['common.button.next']:msg['common.button.clear']}" icon="#{prplanBatchImport.finished?'ui-icon ui-icon-play':'ui-icon ui-icon-cancel'}"  
                                                 title="#{memberLoadController.finished?msg['common.button.next']:msg['common.button.clear']}"
                                                 action="#{memberLoadController.reset}" 
                                                 update="@form"
                                                 />
                                <p:spacer width="5px"/>
                            </h:panelGroup>
                        </p:fieldset>
                        
                        <!-- BEGIN: 匯入結果列表 -->
                        <p:fieldset id="uploadResult" legend="匯入結果">
                            <h:panelGroup rendered="#{memberLoadController.importResultList != null}">
                                <p:dataTable id="tblImport" 
                                             value="#{memberLoadController.importResultList}" var="row" 
                                             styleClass="ui-datatable-hor-scroll"
                                             paginator="true" rows="10" 
                                             >
                                    <f:facet  name="header">
                                        <h:panelGroup rendered="#{memberLoadController.importResultList != null}">
                                            (共#{memberLoadController.importResultList.size()}筆)
                                        </h:panelGroup>                            
                                    </f:facet>
                                    <p:column headerText="Key">
                                        <f:facet name="header">
                                            <h:outputText value="Key" />  
                                        </f:facet>       
                                        <h:outputText value="USER_INFO" />  
                                    </p:column>
                                    <p:column filterBy="#{row.loginAccount}" filterMatchMode="contains" >
                                        <f:facet name="header">
                                            <h:outputText value="會員帳號" />  
                                        </f:facet> 
                                        <h:outputText value="#{row.loginAccount}"/>
                                    </p:column>
                                    <p:column filterBy="#{row.name}" filterMatchMode="contains" >
                                        <f:facet name="header">
                                            <h:outputText value="姓名" />  
                                        </f:facet>                                 
                                        <h:outputText value="#{row.name}"/>
                                    </p:column>
                                    <p:column filterBy="#{row.phone}" filterMatchMode="contains" >
                                        <f:facet name="header">
                                            <h:outputText value="電話" />  
                                        </f:facet>                                 
                                        <h:outputText value="#{row.phone}"/>
                                    </p:column>
                                    <p:column style="white-space: normal; word-break: break-all" width="180px" >
                                        <f:facet name="header">
                                            <h:outputText value="供應商代碼" />  
                                        </f:facet> 
                                        <h:outputText value="#{row.venderCodes}"/>
                                    </p:column>
                                </p:dataTable>  
                                <!-- /div -->
                            </h:panelGroup>    
                        </p:fieldset>
                        <!-- BEGIN: 匯入結果列表 -->
                    </h:form><!-- importForm -->
                    <ui:include src="/member/inc_note.xhtml"/>                     
                </p:tab>
                
                <!-- 匯出 TAB -->
                <p:tab title="#{msg['userloader.export.title']}" id="export">
                    <h:form prependId="false" id="dataExportForm">
                        <p:messages id="messages2"/>
                        
                        <!-- BEGIN: 查詢條件元件區 -->
                        <p:fieldset legend="#{msg['search.critical']}:" toggleable="true" toggleSpeed="500">
                            <p:panelGrid columns="6" >
                                <p:outputLabel value="帳號或姓名關鍵字：" />
                                <p:inputText id="itKeyword" maxlength="30" size="20" value="#{memberLoadController.criteriaVO.keyword}" />
                                <p:watermark for="itKeyword" value="輸入帳號或姓名關鍵字" />
                                    
<!--                                <p:outputLabel value="：" />
                                <p:inputText id="itKeyword" maxlength="30" size="20" value="#{memberLoadController.criteriaVO.keyword}" />
                                <p:watermark for="itKeyword" value="輸入帳號或姓名關鍵字" />-->
                            </p:panelGrid>
                            
                            <!--查詢-->
                            <p:commandButton value="查詢"
                                             icon="ui-icon-search"
                                             update="@form"
                                             actionListener="#{memberLoadController.query()}" 
                                             />
                            <!--清除按鈕-->
                            <p:spacer width="5px"/>
                            <p:commandButton value="#{msg['common.button.clear']}" 
                                             icon="ui-icon ui-icon-cancel"  
                                             title="#{msg['common.button.clear']}"
                                             actionListener="#{memberLoadController.resetExport()}" 
                                             update="@form"
                                             />
                        </p:fieldset>
                        <!-- END: 查詢條件元件區 -->
                        
                        <p/>
                        <p:fieldset id="searchResult" legend="#{msg['search.result']}:">
                            <!-- 匯出 EXCEL -->
                            <h:commandLink id="clQuerydataExporter" rendered="#{memberLoadController.loaderVOList != null}">  
                                <h:graphicImage width="32" height="32" alt="#{msg['common.export.excel']}" library="images" name="excel.png" style="vertical-align: bottom; border:0" />
                                <h:outputLabel value="#{msg['common.export.excel']}"/>
                                <p:dataExporter type="xls" target="dtResult" fileName="MemberInfoExprot"/>                                    
                            </h:commandLink>
                            
                            <!-- BEGIN: 查詢結果列表 -->
                            <h:outputText id="otRowCount" value="(共#{memberLoadController.countAfterFilter}筆)"/>
                            <p:dataTable id="dtResult" 
                                         value="#{memberLoadController.loaderVOList}" 
                                         var="row" 
                                         paginator="true" rows="10" 
                                         widgetVar="userLoaderWidgetVar"
                                         styleClass="ui-datatable-hor-scroll"
                                         filteredValue="#{memberLoadController.filterResultList}" >
                                <!-- filter 後變更筆數 -->
                                <p:ajax event="filter" listener="#{memberLoadController.onFilter}" update=":tabView:dataExportForm:otRowCount" />
                                <p:column headerText="Key" width="100" >
                                    <f:facet name="header">
                                        <h:outputText value="Key" />  
                                    </f:facet>       
                                    <h:outputText value="USER_INFO" />  
                                </p:column>
                                <p:column sortBy="#{row.loginAccount}" width="100"  
                                          filterBy="#{row.loginAccount}" filterMatchMode="contains" filterStyle="width:70px"
                                          style="text-align: center; min-width:80px;" >
                                    <f:facet name="header">
                                        <h:outputText value="會員帳號" />  
                                    </f:facet> 
                                    <h:outputText value="#{row.loginAccount}"/>
                                </p:column>
                                <p:column sortBy="#{row.name}" width="80"
                                          filterBy="#{row.name}" filterMatchMode="contains" filterStyle="width:60px"
                                          style="text-align: center; min-width:80px;" >
                                    <f:facet name="header">
                                        <h:outputText value="姓名" />  
                                    </f:facet>                                 
                                    <h:outputText value="#{row.name}"/>
                                </p:column>
                                <p:column sortBy="#{row.phone}" width="160"  
                                          filterBy="#{row.phone}" filterMatchMode="contains" filterStyle="width:60px"
                                          style="text-align: center; min-width:80px;" >
                                    <f:facet name="header">
                                        <h:outputText value="電話" />  
                                    </f:facet>                                 
                                    <h:outputText value="#{row.phone}"/>
                                </p:column>
                                <p:column filterBy="#{row.venderCodes}" filterMatchMode="contains" 
                                          style="white-space: normal; word-break: break-all" filterStyle="width:180px" >
                                    <f:facet name="header" >
                                        <h:outputText value="供應商代碼" />  
                                    </f:facet> 
                                    <h:outputText value="#{row.venderCodes}" />
                                </p:column>
                            </p:dataTable>
                        </p:fieldset>
                        <!-- END: 查詢結果列表 -->
                    </h:form>
                    <ui:include src="/member/inc_note.xhtml"/>       
                </p:tab>
            </p:tabView>
        </p:panel>
    </ui:define>
</ui:composition>

<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                >
    <style type="text/css">
        .imgPanel {
            text-align:center;
            vertical-align: middle; 
            width: 180px;
            padding:0;
            margin: 0;  
            word-break: break-all;
        }
        .imgItem {
            max-width: 156px;
            max-height: 156px;
            /*position: absolute;
            clip: rect(0px, 150px, 150px, 0px);*/
        }
        .col35 {
        }
        .col65 {
           text-align: center;  
        }
    </style>
    
    <!-- BEGIN: 包含圖片 -->
    <h:panelGroup id="pgIncList" >
        <p:dataGrid id="dgImg" var="img" lazy="true" 
                    value="#{photos.lazyModel}"  
                    rows="#{photos.choiceOnly? 20:10}" columns="5" 
                    paginator="true" paginatorPosition="bottom"
                    rowIndexVar="idx" 
                    >
            <f:facet name="header">
                <p:commandButton value="#{photos.showTree?'隱藏樹狀圖':'顯示樹狀圖'}"
                                 icon="#{photos.showTree?'ui-icon-folder-collapsed':'ui-icon-folder-open'}" 
                                 actionListener="#{photos.displayTree()}" update=":fmMain" ></p:commandButton>
                <p:spacer width="10" height="10" />
                <p:outputLabel value="#{photos.editVO.cname}包含圖片" rendered="#{photos.showEditNodeBlock()}" />
                <p:outputLabel value="包含圖片" rendered="#{!photos.showEditNodeBlock()}" />
            </f:facet>
            
            <p:panel styleClass="imgPanel">
                <!-- 縮圖顯示
                <p:commandLink actionListener="#{photos.prepareGalleriaImages(idx)}" 
                <p:commandLink actionListener="#{imageController.viewImage(img.attachmentVO)}" 
                -->
                #{photos.prepareImageUrl(img)}<!-- 取得影片網址 (顯示該頁才執行提升校能) -->

                <p:commandLink actionListener="#{photos.prepareGalleriaImages(idx)}" 
                               update=":showImgForm"
                               oncomplete="PF('wvImgDlg').show();" 
                               title="#{img.subject}" >
                    <h:graphicImage url="#{ui.genJsfImgUrlS(img.url)}" styleClass="imgItem" /> 
                </p:commandLink>
                <br/>
                <p:outputLabel value="#{img.description}" />
                <br />
                
                <h:panelGroup rendered="#{photos.canEditImage(img)}" >
                    <!-- 狀態 -->
                    <p:outputLabel value="狀態：" styleClass="fieldname" />
                    <p:selectOneMenu value="#{img.status}" >
                        <f:selectItems value="#{ui.contentStatusOptions}" ></f:selectItems>
                        <p:ajax event="change" listener="#{photos.changeImgStatus(img)}" />
                    </p:selectOneMenu>
                    <br />
                    <!-- 刪除 -->
                    <p:commandLink rendered="#{photos.canDeleteImage(img)}" 
                                   title="刪除此項目" 
                                   onstart="if( !confirm('您確定要刪除嗎?') ){ return false; }"
                                   actionListener="#{photos.deleteImage(img)}"
                                   update=":fmMain:pgIncList" >
                        <h:graphicImage library="images" name="delete.png" styleClass="icons" />
                    </p:commandLink>
                    <p:spacer width="2" height="5"/>
                    <!-- 編輯 -->
                    <p:commandLink title="編輯圖片說明與狀態" 
                                   actionListener="#{photos.editImage(img)}"
                                   update=":fmMain:pgOptions"
                                   oncomplete="gotoTop();" >
                        <h:graphicImage library="images" name="edit.png" styleClass="icons" />
                    </p:commandLink>
                    <p:spacer width="2" height="5"/>
                </h:panelGroup>
                
                <!-- 下載 -->
                <h:commandLink title="下載" actionListener="#{file.fetchDocFile(img.attachmentVO)}" >
                    <h:graphicImage library="images" name="download.png" styleClass="icons" />
                    <p:fileDownload value="#{file.downloadFile}" />
                    <p:outputLabel value="下載" rendered="#{!photos.canEditImage(img)}" />
                </h:commandLink>
                
                <!-- 選取 -->
                <p:commandLink rendered="#{photos.choiceOnly}"
                               actionListener="#{photos.selectDocImage(img)}" 
                               oncomplete="selectImage('#{ui.genWebImgUrlB(img.url)}', '#{img.description}');" 
                               style="cursor: pointer;"
                               immediate="true" >
                    <h:graphicImage library="images" name="link_go.png" styleClass="icons" />
                    <p:outputLabel value="選取" />
                </p:commandLink>
            </p:panel>
        </p:dataGrid>
    </h:panelGroup>
    <!-- END: 包含圖片 -->
    
</ui:composition>
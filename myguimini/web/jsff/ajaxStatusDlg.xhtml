<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                >
    <p:ajaxStatus widgetVar="ajaxStatus"
                  onstart="if (ajaxStatusShow) ajaxStatusDlg.show();"
                  onerror="ajaxStatusDlg.hide();ajaxStatusShow = true;"
                  onsuccess="ajaxStatusDlg.hide();ajaxStatusShow = true;"/>
    <p:dialog header="處理中" 
              widgetVar="ajaxStatusDlg" 
              modal="true" 
              resizable="false"
              draggable="false" 
              closable="false">
        <h:graphicImage library="images" name="loading9.gif" />
        <p:spacer width="4" />
        <h:outputText value="資料處理中，請稍候..." style="font-size: 16px;"/>
    </p:dialog>
    <script type="text/javascript">
    //<![CDATA[
    var ajaxStatusShow = true;
    ajaxStatus.bindCallback('ajaxComplete', function(event, xhr, settings) {
        if (typeof(xhr) !== 'undefined' && typeof(xhr.status) !== 'undefined') {
            if (xhr.status==200)
                onCompleteCheck(xhr, 'success', ''); // check if view expired.
            else
                onCompleteCheck(xhr, 'error', ''); // logout or session expired.
        }
    });
    
    function downloadStart() {
        ajaxStatusDlg.show();
    }
    function downloadStop() {
        ajaxStatusDlg.hide();
    }
    function monitorDownload() {
        PrimeFaces.monitorDownload(downloadStart, downloadStop);
    }
    //]]>
    </script>
</ui:composition>